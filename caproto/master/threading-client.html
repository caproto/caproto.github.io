<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Threading Client &mdash; caproto 0+untagged.1.g5050c39 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/inheritance.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=362ff35b"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="_static/docs-versions-menu.js?v=302f4f97"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pyepics-Compatible Client" href="pyepics-compat-client.html" />
    <link rel="prev" title="Synchronous Client" href="sync-client.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            caproto
          </a>
              <div class="version">
                0+untagged.1.g5050c39
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="clients.html">Clients</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="command-line-client.html">Command-Line Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="sync-client.html">Synchronous Client</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Threading Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connect">Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read">Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write">Write</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subscribe-monitor">Subscribe (“Monitor”)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batched-requests">Batched Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#go-idle">Go Idle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#canceling-searches">Canceling Searches</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events-off-and-on">Events Off and On</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-health-check">Server Health Check</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logs-for-debugging">Logs for Debugging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-documentation">API Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.Context"><code class="docutils literal notranslate"><span class="pre">Context</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.PV"><code class="docutils literal notranslate"><span class="pre">PV</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.Subscription"><code class="docutils literal notranslate"><span class="pre">Subscription</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.Batch"><code class="docutils literal notranslate"><span class="pre">Batch</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.VirtualCircuitManager"><code class="docutils literal notranslate"><span class="pre">VirtualCircuitManager</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#caproto.threading.client.SharedBroadcaster"><code class="docutils literal notranslate"><span class="pre">SharedBroadcaster</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pyepics-compat-client.html">Pyepics-Compatible Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="async-clients.html">Asynchronous Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_variables.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IOCs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookiecutter.html">IOC Template Cookiecutters</a></li>
<li class="toctree-l1"><a class="reference internal" href="own_docs.html">Writing Your Own Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_api.html">Server API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Caproto-in-a-box</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="clients.html">Clients</a></li>
      <li class="breadcrumb-item active">Threading Client</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/threading-client.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="threading-client">
<h1>Threading Client<a class="headerlink" href="#threading-client" title="Permalink to this heading">¶</a></h1>
<p>The threading client is a high-performance client that uses Python’s built-in
threading module to manage concurrency.</p>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">¶</a></h2>
<p>In a separate shell, start one of caproto’s demo IOCs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.random_walk
PVs:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;random_walk:dt&#39;</span>,<span class="w"> </span><span class="s1">&#39;random_walk:x&#39;</span><span class="o">]</span>
</pre></div>
</div>
<section id="connect">
<h3>Connect<a class="headerlink" href="#connect" title="Permalink to this heading">¶</a></h3>
<p>Now, in Python we will talk to it using caproto’s threading client. Start by
creating a <a class="reference internal" href="#caproto.threading.client.Context" title="caproto.threading.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">caproto.threading.client</span> <span class="kn">import</span> <span class="n">Context</span>

<span class="gp">In [2]: </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#caproto.threading.client.Context" title="caproto.threading.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> object caches connections, manages automatic
re-connection, and tracks the state of connections in progress.
We can use it to request new connections. Formulating requests for many PVs in
a large batch is efficient. In this example we’ll just ask for two PVs.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">,</span> <span class="s1">&#39;random_walk:dt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#caproto.threading.client.Context.get_pvs" title="caproto.threading.client.Context.get_pvs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Context.get_pvs()</span></code></a>  accepts an arbitrary number of PV names and
immediately returns a collection of <a class="reference internal" href="#caproto.threading.client.PV" title="caproto.threading.client.PV"><code class="xref py py-class docutils literal notranslate"><span class="pre">PV</span></code></a> objects representing each name.
In a background thread, the Context searches for an EPICS server that provides
that PV name and then connects to it. The PV object displays its connection
state:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">dt</span>
<span class="gh">Out[4]: </span><span class="go">&lt;PV name=&#39;random_walk:dt&#39; priority=0 (searching....)&gt;</span>
</pre></div>
</div>
<p>The Context displays aggregate information about the state of all connections.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">ctx</span>
<span class="gh">Out[5]: </span><span class="go">&lt;Context searches_pending=0 circuits=0 pvs=2 idle=0&gt;</span>
</pre></div>
</div>
</section>
<section id="read">
<h3>Read<a class="headerlink" href="#read" title="Permalink to this heading">¶</a></h3>
<p>Now, to read a PV:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="gp">In [7]: </span><span class="n">res</span>
<span class="gh">Out[7]: </span><span class="go">ReadNotifyResponse(data=array([3.]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)</span>
</pre></div>
</div>
<p>This object is a human-friendly representation of the server’s response. The
raw bytes of that response are:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="nb">bytes</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="gh">Out[8]: </span><span class="go">b&#39;\x00\x0f\x00\x08\x00\x06\x00\x01\x00\x00\x00\x01\x00\x00\x00\x00@\x08\x00\x00\x00\x00\x00\x00&#39;</span>
</pre></div>
</div>
<p>Access particular fields in the response using attribute (“dot”) access on <code class="docutils literal notranslate"><span class="pre">res</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">res</span><span class="o">.</span><span class="n">data</span>
<span class="gh">Out[9]: </span><span class="go">array([3.])</span>
</pre></div>
</div>
<p>By default, the client does not request any metadata</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">res</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter to request a richer data type.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">richer_res</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="gp">In [12]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span>
<span class="gh">Out[12]: </span><span class="go">DBR_TIME_DOUBLE(status=&lt;AlarmStatus.NO_ALARM: 0&gt;, severity=&lt;AlarmSeverity.NO_ALARM: 0&gt;, timestamp=1699573467.408718)</span>

<span class="gp">In [13]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">timestamp</span>
<span class="gh">Out[13]: </span><span class="go">1699573467.408718</span>

<span class="gp">In [14]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">as_datetime</span><span class="p">()</span>  <span class="c1"># a convenience method</span>
<span class="gh">Out[14]: </span><span class="go">datetime.datetime(2023, 11, 9, 23, 44, 27, 408718)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#caproto.threading.client.PV.read" title="caproto.threading.client.PV.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.read()</span></code></a> for more information on the values accepted by the
<code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Performance Note</strong></p>
<p>The underlying metadata and data are stored in efficient, contiguous-memory
data structures.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">res</span><span class="o">.</span><span class="n">header</span>  <span class="c1"># a ctypes.BigEndianStructure</span>
<span class="gh">Out[15]: </span><span class="go">MessageHeader(command=15, payload_size=8, data_type=6, data_count=1, parameter1=1, parameter2=0)</span>

<span class="gp">In [16]: </span><span class="n">res</span><span class="o">.</span><span class="n">buffers</span>  <span class="c1"># a collection of one or more buffers</span>
<span class="gh">Out[16]: </span><span class="go">(b&#39;&#39;, &lt;memory at 0x7f7ca8c56640&gt;)</span>
</pre></div>
</div>
<p>They were received directly from the socket into these structure with no
intermediate copies. Accessing the <code class="docutils literal notranslate"><span class="pre">res.data</span></code> — which returns a
<code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="docutils literal notranslate"><span class="pre">array.array</span></code> — provides a view onto that same
memory with no copying (if the data was received from the socket all at
once) or one copy (if the data bridged multiple receipts).</p>
</div>
</section>
<section id="write">
<h3>Write<a class="headerlink" href="#write" title="Permalink to this heading">¶</a></h3>
<p>Let us set the value to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[17]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=2)</span>
</pre></div>
</div>
<p>By default, we send <code class="docutils literal notranslate"><span class="pre">WriteNotifyResponse</span></code>, wait for a response, and return
it. There are a couple other ways we can handle writes:</p>
<ul>
<li><p>Return immediately, not asking for or waiting for a response.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Return immediately, not waiting for a response, but handing the response
(when it arrived) to some callback function, processed on a background
thread.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;got a response:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>See the <a class="reference internal" href="#caproto.threading.client.PV.write" title="caproto.threading.client.PV.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.write()</span></code></a> for more.</p>
</section>
<section id="subscribe-monitor">
<h3>Subscribe (“Monitor”)<a class="headerlink" href="#subscribe-monitor" title="Permalink to this heading">¶</a></h3>
<p>Let us now monitor a channel. The server updates the <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> channel
periodically at some period set by <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>. We can subscribe to
updates and fan them out to one or more user-defined callback functions.
First, we define a <a class="reference internal" href="#caproto.threading.client.Subscription" title="caproto.threading.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">sub</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, we define a callback function, a function that will be called whenever
the server sends an update. It must accept two positional arguments.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [20]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received response from&#39;</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>This user-defined function <code class="docutils literal notranslate"><span class="pre">f</span></code> has access to the full response from the
server, which includes data and any metadata. The server’s response does not
include the name of the PV involved (it identifies it indirectly via a
“subscription ID” code) so caproto provides the function with <code class="docutils literal notranslate"><span class="pre">sub</span></code> as well,
from which you can obtain the pertinent PV <code class="docutils literal notranslate"><span class="pre">sub.pv</span></code> and its name
<code class="docutils literal notranslate"><span class="pre">sub.pv.name</span></code> as illustrated above. This is useful for distinguishing
responses when the same function is added to multiple subscriptions.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>The expected signature of the callback function was changed from
<code class="docutils literal notranslate"><span class="pre">f(response)</span></code> to <code class="docutils literal notranslate"><span class="pre">f(sub,</span> <span class="pre">response)</span></code>. For backward compatibility,
functions with signature <code class="docutils literal notranslate"><span class="pre">f(response)</span></code> are still accepted, but caproto
will issue a warning that a future release may require the new signature,
<code class="docutils literal notranslate"><span class="pre">f(sub,</span> <span class="pre">response)</span></code>.</p>
</div>
<p>We register this function with <code class="docutils literal notranslate"><span class="pre">sub</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">token</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">token</span></code> is just an integer which we can use to remove <code class="docutils literal notranslate"><span class="pre">f</span></code> later. We can
define a second callback:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [23]: </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>and add it to the same subscription, putting no additional load on the network.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="gh">Out[24]: </span><span class="go">1</span>
</pre></div>
</div>
<p>After some time has passed, we will have accumulated some responses.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="gh">Out[25]: </span><span class="go">4</span>

<span class="gp">In [26]: </span><span class="n">values</span>
<span class="gh">Out[26]: </span>
<span class="go">[-0.6839478484544224,</span>
<span class="go"> 0.23554329772572857,</span>
<span class="go"> -0.3253150958860711,</span>
<span class="go"> -1.2957948991152692]</span>
</pre></div>
</div>
<p>At any point we can remove a specific callback function:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">sub</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<p>or clear all the callbacks on a subscription:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="n">sub</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to minimize load on the network, a <a class="reference internal" href="#caproto.threading.client.Subscription" title="caproto.threading.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> waits to
request updates from the server until the first user callback is added. Thus,
the first callback added by the user is guaranteed to get the first response
received from the server. If all user callbacks are later removed, either
explicitly (via <code class="docutils literal notranslate"><span class="pre">remove_callback</span></code> or <code class="docutils literal notranslate"><span class="pre">clear</span></code>) or implicitly via Python
garbage collection, the Subscription automatically cancels future updates from
the server.  If a callback is then later added, the Subscription silently
re-initiates updates. All of this is transparent to the user.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The callback registry in <a class="reference internal" href="#caproto.threading.client.Subscription" title="caproto.threading.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a>  only holds weak references
to the user callback functions. If there are no other references to the
function, it will be silently garbage collected and removed. Therefore,
constructions like this do not work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
<p>The lambda function will be promptly garbage collected by Python and
removed from <code class="docutils literal notranslate"><span class="pre">sub</span></code> by caproto. To avoid that, make a reference before
passing the function to <a class="reference internal" href="#caproto.threading.client.Subscription.add_callback" title="caproto.threading.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Subscription.add_callback()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be surprising, but it is a standard approach for avoiding the
accidental costly accumulation of abandoned callbacks.</p>
<p>This pitfall does not apply to callbacks passed to <a class="reference internal" href="#caproto.threading.client.PV.read" title="caproto.threading.client.PV.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.read()</span></code></a> and
<a class="reference internal" href="#caproto.threading.client.PV.write" title="caproto.threading.client.PV.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.write()</span></code></a> (or <a class="reference internal" href="#caproto.threading.client.Batch.read" title="caproto.threading.client.Batch.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Batch.read()</span></code></a> and <a class="reference internal" href="#caproto.threading.client.Batch.write" title="caproto.threading.client.Batch.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Batch.write()</span></code></a>) because
those are single-shot callbacks that do not persist beyond their first use.</p>
</div>
</section>
<section id="batched-requests">
<h3>Batched Requests<a class="headerlink" href="#batched-requests" title="Permalink to this heading">¶</a></h3>
<p>Batching requests is efficient, and it sets up the server to perform these
operations as closely-spaced in time as possible, within the limits of the
protocol. Python’s <code class="docutils literal notranslate"><span class="pre">with</span></code> syntax provides a natural way to specify a batch of
requests — reads, writes, or a mixture of both — and execute them upon exit
from the <code class="docutils literal notranslate"><span class="pre">with</span></code> block.</p>
<p>Suppose we had a list of <code class="docutils literal notranslate"><span class="pre">PV</span></code> objects, <code class="docutils literal notranslate"><span class="pre">pvs</span></code>, and we want to request
readings in bulk. We can use a callback function to stash readings in a
dictionary as they arrive.</p>
<p>For convenience we’ll demonstrate this using the two PVs we have handy —
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code> — but an unlimited number may be used.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">pvs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">]</span>

<span class="gp">In [30]: </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="gp">In [31]: </span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

<span class="gp">In [32]: </span><span class="k">def</span> <span class="nf">stash_result</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>Now we’ll use the <a class="reference internal" href="#caproto.threading.client.Batch" title="caproto.threading.client.Batch"><code class="xref py py-class docutils literal notranslate"><span class="pre">Batch</span></code></a> context:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="kn">from</span> <span class="nn">caproto.threading.client</span> <span class="kn">import</span> <span class="n">Batch</span>

<span class="gp">In [34]: </span><span class="k">with</span> <span class="n">Batch</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="k">for</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">pvs</span><span class="p">:</span>
<span class="gp">   ....: </span>        <span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">stash_result</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>The requests will be sent in large batches (over the PVs’ respective circuits)
upon exiting the <code class="docutils literal notranslate"><span class="pre">with</span></code> block. The responses will be processed on a
background thread. As the responses come in, the <code class="docutils literal notranslate"><span class="pre">results</span></code> dictionary will be
updated.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">results</span>
<span class="gh">Out[35]: </span><span class="go">{&#39;random_walk:x&#39;: array([-1.2957949]), &#39;random_walk:dt&#39;: array([1.])}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#caproto.threading.client.Batch" title="caproto.threading.client.Batch"><code class="xref py py-class docutils literal notranslate"><span class="pre">Batch</span></code></a> for more.</p>
</section>
<section id="go-idle">
<h3>Go Idle<a class="headerlink" href="#go-idle" title="Permalink to this heading">¶</a></h3>
<p>Once created, PVs are cached for the lifetime of the <a class="reference internal" href="#caproto.threading.client.Context" title="caproto.threading.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> and
returned again to the user if a PV with the same name and priority is
requested. In order to reduce the load on the network, a PV can be temporarily
made “idle” (disconnected). It will silently, automatically reconnect the next
time it is used.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">x</span>
<span class="gh">Out[36]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 address=(&#39;10.1.0.35&#39;, 5064), circuit_state=States.CONNECTED, channel_state=States.CONNECTED&gt;</span>

<span class="gp">In [37]: </span><span class="n">x</span><span class="o">.</span><span class="n">go_idle</span><span class="p">()</span>

<span class="gp">In [38]: </span><span class="n">x</span>
<span class="gh">Out[38]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 (idle)&gt;</span>

<span class="gp">In [39]: </span><span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[39]: </span><span class="go">ReadNotifyResponse(data=array([-2.04343704]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=5, metadata=None)</span>

<span class="gp">In [40]: </span><span class="n">x</span>
<span class="gh">Out[40]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 address=(&#39;10.1.0.35&#39;, 5064), circuit_state=States.CONNECTED, channel_state=States.CONNECTED&gt;</span>
</pre></div>
</div>
<p>Notice that when the PV was read it automatically reconnected, requiring no
action from the user.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go_idle()</span></code> method is merely a <em>request</em> and is not guaranteed to have
any effect. If a PV has active subscriptions, it will ignore the request: it
must stay active to continue servicing user callbacks. Therefore, it is safe
call <code class="docutils literal notranslate"><span class="pre">go_idle()</span></code> on any PV at any time, knowing that the PV will decline to
disconnect if it is being actively used and that, if it is currently unused, it
will transparently reconnect the next time it is used.</p>
</section>
<section id="canceling-searches">
<h3>Canceling Searches<a class="headerlink" href="#canceling-searches" title="Permalink to this heading">¶</a></h3>
<p>All unanswered searches are retried repeatedly, with decreasing frequency,
forever. Each new call to <a class="reference internal" href="#caproto.threading.client.Context.get_pvs" title="caproto.threading.client.Context.get_pvs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_pvs()</span></code></a> causes all unanswered
searches to be retried at least once immediately. This can generate unwanted
network traffic. To fully cancel a search that is never expected to complete,
access the method <a class="reference internal" href="#caproto.threading.client.SharedBroadcaster.cancel" title="caproto.threading.client.SharedBroadcaster.cancel"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedBroadcaster.cancel</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span><span class="o">.</span><span class="n">broadcaster</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s1">&#39;some typo-ed PV name, for example&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As the name suggests, it is possible to construct multiple Contexts that
share one SharedBroadcaster. In that scenario, notice that canceling the
search will affect all contexts using the SharedBroadcaster.</p>
</section>
<section id="events-off-and-on">
<h3>Events Off and On<a class="headerlink" href="#events-off-and-on" title="Permalink to this heading">¶</a></h3>
<p>If a given circuit produces updates faster than a client can process them, the
client can suspend subscriptions on that circuit. This will causes the server
to discard all backlogged updates and all new updates during the period of
supsension. When the client reactives subscriptions, it will immediate receive
the most recent update and then any future updates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">circuit_manager</span><span class="o">.</span><span class="n">events_off</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">x</span><span class="o">.</span><span class="n">circuit_manager</span><span class="o">.</span><span class="n">events_on</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="server-health-check">
<span id="id1"></span><h3>Server Health Check<a class="headerlink" href="#server-health-check" title="Permalink to this heading">¶</a></h3>
<p>To check how much time has passed (in seconds) since each known server was last
heard from, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span><span class="o">.</span><span class="n">broadcaster</span><span class="o">.</span><span class="n">time_since_last_heard</span><span class="p">()</span>
</pre></div>
</div>
<p>As a convenience, check on the server connected to a specific PV using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">time_since_last_heard</span><span class="p">()</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="#caproto.threading.client.SharedBroadcaster.time_since_last_heard" title="caproto.threading.client.SharedBroadcaster.time_since_last_heard"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SharedBroadcaster.time_since_last_heard()</span></code></a> API documentation below
for details.</p>
</section>
<section id="logs-for-debugging">
<span id="threading-loggers"></span><h3>Logs for Debugging<a class="headerlink" href="#logs-for-debugging" title="Permalink to this heading">¶</a></h3>
<p>Caproto uses Python’s logging framework, which enables sophisticated log
management. For more information and copy/paste-able examples, see
<a class="reference internal" href="loggers.html#loggers"><span class="std std-ref">Logging</span></a>.</p>
</section>
</section>
<section id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.Context">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">Context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">broadcaster</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Context" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates the state and connections of a client</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>broadcaster</strong><span class="classifier">SharedBroadcaster, optional</span></dt><dd><p>If None is specified, a fresh one is instantiated.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Number of seconds before a CaprotoTimeoutError is raised. This default
can be overridden at the PV level or for any given operation. If unset,
the default is 2 seconds. If None, never timeout. A global timeout can
be specified via an environment variable <code class="docutils literal notranslate"><span class="pre">CAPROTO_DEFAULT_TIMEOUT</span></code>.</p>
</dd>
<dt><strong>host_name</strong><span class="classifier">string, optional</span></dt><dd><p>uses value of <code class="docutils literal notranslate"><span class="pre">socket.gethostname()</span></code> by default</p>
</dd>
<dt><strong>client_name</strong><span class="classifier">string, optional</span></dt><dd><p>uses value of <code class="docutils literal notranslate"><span class="pre">getpass.getuser()</span></code> by default</p>
</dd>
<dt><strong>max_workers</strong><span class="classifier">integer, optional</span></dt><dd><p>Number of worker threaders <em>per VirtualCircuit</em> for executing user
callbacks. Default is 1. For any number of workers, workers will
receive updates in the order which they are received from the server.
That is, work on each update will <em>begin</em> in sequential order.
Work-scheduling internal to the user callback is outside caproto’s
control. If the number of workers is set to greater than 1, the work on
each update may not <em>finish</em> in a deterministic order. For example, if
workers are writing lines into a file, the only way to guarantee that
the lines are ordered properly is to use only one worker. If ordering
matters for your application, think carefully before increasing this
value from 1.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Context.get_pvs">
<span class="sig-name descname"><span class="pre">get_pvs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection_state_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access_rights_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">CONTEXT_DEFAULT_TIMEOUT</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Context.get_pvs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Context.get_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of PV objects.</p>
<p>These objects may not be connected at first. Channel creation occurs on
a background thread.</p>
<p>PVs are uniquely defined by their name and priority. If a PV with the
same name and priority is requested twice, the same (cached) object is
returned. Any callbacks included here are added to added alongside any
existing ones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>*names</strong><span class="classifier">strings</span></dt><dd><p>any number of PV names</p>
</dd>
<dt><strong>priority</strong><span class="classifier">integer</span></dt><dd><p>Used by the server to triage subscription responses when under high
load. 0 is lowest; 99 is highest.</p>
</dd>
<dt><strong>connection_state_callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(pv,</span> <span class="pre">state)</span></code> where <code class="docutils literal notranslate"><span class="pre">pv</span></code> is the instance
of <code class="docutils literal notranslate"><span class="pre">PV</span></code> whose state has changed and <code class="docutils literal notranslate"><span class="pre">state</span></code> is a string</p>
</dd>
<dt><strong>access_rights_callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(pv,</span> <span class="pre">access_rights)</span></code> where <code class="docutils literal notranslate"><span class="pre">pv</span></code> is the
instance of <code class="docutils literal notranslate"><span class="pre">PV</span></code> whose state has changed and <code class="docutils literal notranslate"><span class="pre">access_rights</span></code> is
a member of the caproto <code class="docutils literal notranslate"><span class="pre">AccessRights</span></code> enum</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Number of seconds before a CaprotoTimeoutError is raised. This
default can be overridden for any specific operation. By default,
fall back to the default timeout set by the Context. If None, never
timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.PV">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">PV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV" title="Permalink to this definition">¶</a></dt>
<dd><p>These must be instantiated by a Context, never directly.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#caproto.threading.client.PV.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.priority">
<span class="sig-name descname"><span class="pre">priority</span></span><a class="headerlink" href="#caproto.threading.client.PV.priority" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.context">
<span class="sig-name descname"><span class="pre">context</span></span><a class="headerlink" href="#caproto.threading.client.PV.context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.access_rights">
<span class="sig-name descname"><span class="pre">access_rights</span></span><a class="headerlink" href="#caproto.threading.client.PV.access_rights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.log">
<span class="sig-name descname"><span class="pre">log</span></span><a class="headerlink" href="#caproto.threading.client.PV.log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.component_lock">
<span class="sig-name descname"><span class="pre">component_lock</span></span><a class="headerlink" href="#caproto.threading.client.PV.component_lock" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.circuit_ready">
<span class="sig-name descname"><span class="pre">circuit_ready</span></span><a class="headerlink" href="#caproto.threading.client.PV.circuit_ready" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.channel_ready">
<span class="sig-name descname"><span class="pre">channel_ready</span></span><a class="headerlink" href="#caproto.threading.client.PV.channel_ready" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.connection_state_callback">
<span class="sig-name descname"><span class="pre">connection_state_callback</span></span><a class="headerlink" href="#caproto.threading.client.PV.connection_state_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.access_rights_callback">
<span class="sig-name descname"><span class="pre">access_rights_callback</span></span><a class="headerlink" href="#caproto.threading.client.PV.access_rights_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.subscriptions">
<span class="sig-name descname"><span class="pre">subscriptions</span></span><a class="headerlink" href="#caproto.threading.client.PV.subscriptions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="caproto.threading.client.PV.timeout">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">timeout</span></span><a class="headerlink" href="#caproto.threading.client.PV.timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Effective default timeout.</p>
<p>Valid values are:
* CONTEXT_DEFAULT_TIMEOUT (fall back to Context.timeout)
* a floating-point number
* None (never timeout)</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="caproto.threading.client.PV.circuit_manager">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">circuit_manager</span></span><a class="headerlink" href="#caproto.threading.client.PV.circuit_manager" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="caproto.threading.client.PV.channel">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">channel</span></span><a class="headerlink" href="#caproto.threading.client.PV.channel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.access_rights_changed">
<span class="sig-name descname"><span class="pre">access_rights_changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rights</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.access_rights_changed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.access_rights_changed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.connection_state_changed">
<span class="sig-name descname"><span class="pre">connection_state_changed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.connection_state_changed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.connection_state_changed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="caproto.threading.client.PV.connected">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connected</span></span><a class="headerlink" href="#caproto.threading.client.PV.connected" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.wait_for_search">
<span class="sig-name descname"><span class="pre">wait_for_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PV_DEFAULT_TIMEOUT</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.wait_for_search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.wait_for_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for this PV to be found.</p>
<p>This does not wait for the PV’s Channel to be created; it merely waits
for an address (and a VirtualCircuit) to be assigned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to Context.timeout if not set. If
None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.wait_for_connection">
<span class="sig-name descname"><span class="pre">wait_for_connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PV_DEFAULT_TIMEOUT</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.wait_for_connection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.wait_for_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for this PV to be connected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.go_idle">
<span class="sig-name descname"><span class="pre">go_idle</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.go_idle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.go_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Request to clear this Channel to reduce load on client and server.</p>
<p>A new Channel will be automatically, silently created the next time any
method requiring a connection is called. Thus, this saves some memory
in exchange for making the next request a bit slower, as it has to
redo the handshake with the server first.</p>
<p>If there are any subscriptions with callbacks, this request will be
ignored. If the PV is in the process of connecting, this request will
be ignored.  If there are any actions in progress (read, write) this
request will be processed when they are complete.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PV_DEFAULT_TIMEOUT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">notify</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Request a fresh reading.</p>
<p>Can do one or both of:
- Block while waiting for the response, and return it.
- Pass the response to callback, with or without blocking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>wait</strong><span class="classifier">boolean</span></dt><dd><p>If True (default) block until a matching response is
received from the server. Raises CaprotoTimeoutError if that
response is not received within the time specified by the <cite>timeout</cite>
parameter.</p>
</dd>
<dt><strong>callback</strong><span class="classifier">callable or None</span></dt><dd><p>Called with the response as its argument when received.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
<dt><strong>notify: boolean, optional</strong></dt><dd><p>Send a <code class="docutils literal notranslate"><span class="pre">ReadNotifyRequest</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">ReadRequest</span></code>. True by
default.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PV_DEFAULT_TIMEOUT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">notify</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a new value. Optionally, request confirmation from the server.</p>
<p>Can do one or both of:
- Block while waiting for the response, and return it.
- Pass the response to callback, with or without blocking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data</strong><span class="classifier">str, int, or float or any Iterable of these</span></dt><dd><p>Value(s) to write.</p>
</dd>
<dt><strong>wait</strong><span class="classifier">boolean</span></dt><dd><p>If True (default) block until a matching WriteNotifyResponse is
received from the server. Raises CaprotoTimeoutError if that
response is not received within the time specified by the <cite>timeout</cite>
parameter.</p>
</dd>
<dt><strong>callback</strong><span class="classifier">callable or None</span></dt><dd><p>Called with the WriteNotifyResponse as its argument when received.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
<dt><strong>notify</strong><span class="classifier">boolean or None</span></dt><dd><p>If None (default), set to True if wait=True or callback is set.
Can be manually set to True or False. Will raise ValueError if set
to False while wait=True or callback is set.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Write specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.subscribe">
<span class="sig-name descname"><span class="pre">subscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.subscribe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Start a new subscription to which user callback may be added.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
<dt><strong>low, high, to</strong><span class="classifier">float, optional</span></dt><dd><p>deprecated by Channel Access, not yet implemented by caproto</p>
</dd>
<dt><strong>mask</strong><span class="classifier">SubscriptionType, optional</span></dt><dd><p>Subscribe to selective updates.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>subscription</strong><span class="classifier">Subscription</span></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Define a subscription.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>
</pre></div>
</div>
<p>Add a user callback. The subscription will be transparently activated
(i.e. an <code class="docutils literal notranslate"><span class="pre">EventAddRequest</span></code> will be sent) when the first user callback
is added.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">my_func</span><span class="p">)</span>
</pre></div>
</div>
<p>Multiple callbacks may be added to the same subscription.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">another_func</span><span class="p">)</span>
</pre></div>
</div>
<p>See the docstring for <a class="reference internal" href="#caproto.threading.client.Subscription" title="caproto.threading.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> for more.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.unsubscribe_all">
<span class="sig-name descname"><span class="pre">unsubscribe_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.unsubscribe_all"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.unsubscribe_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear all subscriptions. (Remove all user callbacks from them.)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.PV.time_since_last_heard">
<span class="sig-name descname"><span class="pre">time_since_last_heard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PV_DEFAULT_TIMEOUT</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#PV.time_since_last_heard"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.PV.time_since_last_heard" title="Permalink to this definition">¶</a></dt>
<dd><p>Seconds since last message from the server that provides this channel.</p>
<p>The time is reset to 0 whenever we receive a TCP message related to
user activity <em>or</em> a Beacon. Servers are expected to send Beacons at
regular intervals. If we do not receive either a Beacon or TCP message,
we initiate an Echo over TCP, to which the server is expected to
promptly respond.</p>
<p>Therefore, the time reported here should not much exceed
<code class="docutils literal notranslate"><span class="pre">EPICS_CA_CONN_TMO</span></code> (default 30 seconds unless overriden by that
environment variable) if the server is healthy.</p>
<p>If the server fails to send a Beacon on schedule <em>and</em> fails to reply to
an Echo, the server is assumed dead. A warning is issued, and all PVs
are disconnected to initiate a reconnection attempt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.PV.command_bundle_queue">
<span class="sig-name descname"><span class="pre">command_bundle_queue</span></span><a class="headerlink" href="#caproto.threading.client.PV.command_bundle_queue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.Subscription">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">Subscription</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Subscription"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Subscription" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents one subscription, specified by a PV and configurational parameters</p>
<p>It may fan out to zero, one, or multiple user-registered callback
functions.</p>
<p>This object should never be instantiated directly by user code; rather
it should be made by calling the <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code> method on a <code class="docutils literal notranslate"><span class="pre">PV</span></code> object.</p>
<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Subscription.add_callback">
<span class="sig-name descname"><span class="pre">add_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Subscription.add_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Subscription.add_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a callback to receive responses.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>func</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
<p>The signature <code class="docutils literal notranslate"><span class="pre">func(response)</span></code> is also supported for
backward-compatibility but will issue warnings. Support will be
removed in a future release of caproto.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>token</strong><span class="classifier">int</span></dt><dd><p>Integer token that can be passed to <a class="reference internal" href="#caproto.threading.client.Subscription.remove_callback" title="caproto.threading.client.Subscription.remove_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_callback()</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Changed the expected signature of <code class="docutils literal notranslate"><span class="pre">func</span></code> from <code class="docutils literal notranslate"><span class="pre">func(response)</span></code>
to <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Subscription.clear">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Subscription.clear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Subscription.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all callbacks.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Subscription.remove_callback">
<span class="sig-name descname"><span class="pre">remove_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Subscription.remove_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Subscription.remove_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove callback using token that was returned by <a class="reference internal" href="#caproto.threading.client.Subscription.add_callback" title="caproto.threading.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_callback()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>token</strong><span class="classifier">integer</span></dt><dd><p>Token returned by <a class="reference internal" href="#caproto.threading.client.Subscription.add_callback" title="caproto.threading.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_callback()</span></code></a>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.Batch">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">Batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Accumulate requests and then issue them all in batch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None</span></dt><dd><p>Number of seconds to wait before ignoring late responses. Default
is 2.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Read some PVs in batch and stash the readings in a dictionary as they
come in.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">stash_result</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Batch</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">pvs</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pv</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">stash_result</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="gp">... </span>    <span class="c1"># The requests are sent upon exiting this &#39;with&#39; block.</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">results</span></code> dictionary will be populated as responses come in.</p>
<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Batch.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Batch.read"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Batch.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Request a fresh reading as part of a batched request.</p>
<p>Notice that, unlike <a class="reference internal" href="#caproto.threading.client.PV.read" title="caproto.threading.client.PV.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.read()</span></code></a>, the callback is required. (There
is no other way to get the result back from a batched read.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>pv</strong><span class="classifier">PV</span></dt><dd></dd>
<dt><strong>callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(response)</span></code></p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.Batch.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#Batch.write"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.Batch.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a new value as part of a batched request.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>pv</strong><span class="classifier">PV</span></dt><dd></dd>
<dt><strong>data</strong><span class="classifier">str, int, or float or any Iterable of these</span></dt><dd><p>Value(s) to write.</p>
</dd>
<dt><strong>callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(response)</span></code></p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The following are internal components. There API may change in the future.</p>
<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">VirtualCircuitManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">circuit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates a VirtualCircuit, a TCP socket, and additional state</p>
<p>This object should never be instantiated directly by user code. It is used
internally by the Context. Its methods may be touched by user code, but
this is rarely necessary.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.context">
<span class="sig-name descname"><span class="pre">context</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.circuit">
<span class="sig-name descname"><span class="pre">circuit</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.circuit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.log">
<span class="sig-name descname"><span class="pre">log</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.log" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.channels">
<span class="sig-name descname"><span class="pre">channels</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.channels" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.pvs">
<span class="sig-name descname"><span class="pre">pvs</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.pvs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.ioids">
<span class="sig-name descname"><span class="pre">ioids</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.ioids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.subscriptions">
<span class="sig-name descname"><span class="pre">subscriptions</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.subscriptions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.selector">
<span class="sig-name descname"><span class="pre">selector</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.selector" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.user_callback_executor">
<span class="sig-name descname"><span class="pre">user_callback_executor</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.user_callback_executor" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.last_tcp_receipt">
<span class="sig-name descname"><span class="pre">last_tcp_receipt</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.last_tcp_receipt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.all_created_pvnames">
<span class="sig-name descname"><span class="pre">all_created_pvnames</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.all_created_pvnames" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.dead">
<span class="sig-name descname"><span class="pre">dead</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.dead" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.socket">
<span class="sig-name descname"><span class="pre">socket</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.socket" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.connected">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connected</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.connected" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.send">
<span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">commands</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager.send"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.send" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.received">
<span class="sig-name descname"><span class="pre">received</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bytes_recv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">address</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager.received"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.received" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive and process and next command from the virtual circuit.</p>
<p>This will be run on the recv thread</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.events_off">
<span class="sig-name descname"><span class="pre">events_off</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager.events_off"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.events_off" title="Permalink to this definition">¶</a></dt>
<dd><p>Suspend updates to all subscriptions on this circuit.</p>
<p>This may be useful if the server produces updates faster than the
client can processs them.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.events_on">
<span class="sig-name descname"><span class="pre">events_on</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager.events_on"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.events_on" title="Permalink to this definition">¶</a></dt>
<dd><p>Reactive updates to all subscriptions on this circuit.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.disconnect">
<span class="sig-name descname"><span class="pre">disconnect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#VirtualCircuitManager.disconnect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.disconnect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.process_queue">
<span class="sig-name descname"><span class="pre">process_queue</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.process_queue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="caproto.threading.client.VirtualCircuitManager.processing">
<span class="sig-name descname"><span class="pre">processing</span></span><a class="headerlink" href="#caproto.threading.client.VirtualCircuitManager.processing" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">caproto.threading.client.</span></span><span class="sig-name descname"><span class="pre">SharedBroadcaster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">registration_retry_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster" title="Permalink to this definition">¶</a></dt>
<dd><p>A broadcaster client which can be shared among multiple Contexts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>registration_retry_time</strong><span class="classifier">float, optional</span></dt><dd><p>The time, in seconds, between attempts made to register with the
repeater. Default is 10.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.new_id">
<span class="sig-name descname"><span class="pre">new_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.new_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.new_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.add_listener">
<span class="sig-name descname"><span class="pre">add_listener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">listener</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.add_listener"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.add_listener" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.remove_listener">
<span class="sig-name descname"><span class="pre">remove_listener</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">listener</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.remove_listener"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.remove_listener" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.disconnect">
<span class="sig-name descname"><span class="pre">disconnect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.disconnect"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.disconnect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.send">
<span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">commands</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.send"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a command and transport it over the UDP socket.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.get_cached_search_result">
<span class="sig-name descname"><span class="pre">get_cached_search_result</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.get_cached_search_result"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.get_cached_search_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns address if found, raises KeyError if missing or stale.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.search">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results_queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for PV names.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">results_queue</span></code> will receive <code class="docutils literal notranslate"><span class="pre">(address,</span> <span class="pre">names)</span></code> (the address of
a server and a list of name(s) that it has) when results are received.</p>
<p>If a cached result is already known, it will be put immediately into
<code class="docutils literal notranslate"><span class="pre">results_queue</span></code> from this thread during this method’s execution.</p>
<p>If not, a SearchRequest will be sent from another thread. If necessary,
the request will be re-sent periodically. When a matching response is
received (by yet another thread) <code class="docutils literal notranslate"><span class="pre">(address,</span> <span class="pre">names)</span></code> will be put into
the <code class="docutils literal notranslate"><span class="pre">results_queue</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.cancel">
<span class="sig-name descname"><span class="pre">cancel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.cancel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.cancel" title="Permalink to this definition">¶</a></dt>
<dd><p>Cancel searches for these names.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>*names</strong><span class="classifier">strings</span></dt><dd><p>any number of PV names</p>
</dd>
<dt><strong>Any PV instances that were awaiting these results will be stuck until</strong></dt><dd></dd>
<dt><strong>:meth:`get_pvs` is called again.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.search_now">
<span class="sig-name descname"><span class="pre">search_now</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.search_now"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.search_now" title="Permalink to this definition">¶</a></dt>
<dd><p>Force the Broadcaster to reissue all unanswered search requests now.</p>
<p>Left to its own devices, the Broadcaster will do this at regular
intervals automatically. This method is intended primarily for
debugging and should not be needed in normal use.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.received">
<span class="sig-name descname"><span class="pre">received</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bytes_recv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">address</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.received"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.received" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive and process and next command broadcasted over UDP.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.command_loop">
<span class="sig-name descname"><span class="pre">command_loop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.command_loop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.command_loop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="caproto.threading.client.SharedBroadcaster.time_since_last_heard">
<span class="sig-name descname"><span class="pre">time_since_last_heard</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/threading/client.html#SharedBroadcaster.time_since_last_heard"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#caproto.threading.client.SharedBroadcaster.time_since_last_heard" title="Permalink to this definition">¶</a></dt>
<dd><p>Map each known server address to seconds since its last message.</p>
<p>The time is reset to 0 whenever we receive a TCP message related to
user activity <em>or</em> a Beacon. Servers are expected to send Beacons at
regular intervals. If we do not receive either a Beacon or TCP message,
we initiate an Echo over TCP, to which the server is expected to
promptly respond.</p>
<p>Therefore, the time reported here should not much exceed
<code class="docutils literal notranslate"><span class="pre">EPICS_CA_CONN_TMO</span></code> (default 30 seconds unless overriden by that
environment variable) if the server is healthy.</p>
<p>If the server fails to send a Beacon on schedule <em>and</em> fails to reply to
an Echo, the server is assumed dead. A warning is issued, and all PVs
are disconnected to initiate a reconnection attempt.</p>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sync-client.html" class="btn btn-neutral float-left" title="Synchronous Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pyepics-compat-client.html" class="btn btn-neutral float-right" title="Pyepics-Compatible Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Daniel Allan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>