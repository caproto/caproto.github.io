<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input-Output Controllers (IOCs) &mdash; caproto 0+untagged.1.gd46a95c documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/inheritance.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=73683010"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="_static/docs-versions-menu.js?v=302f4f97"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="caproto.server.PVGroup" href="generated/caproto.server.PVGroup.html" />
    <link rel="prev" title="Logging" href="loggers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            caproto
          </a>
              <div class="version">
                0+untagged.1.gd46a95c
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
<li class="toctree-l1"><a class="reference internal" href="clients.html">Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_variables.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IOCs</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Input-Output Controllers (IOCs)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-write-an-ioc-using-caproto">Why Write an IOC Using Caproto?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-ioc-examples">Using the IOC Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pvgroup">PVGroup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#group-write">group_write</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alarms">Alarms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.PVGroup.html">caproto.server.PVGroup</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pvproperty">pvproperty</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-configuration">Basic configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#value-or-dtype"><code class="docutils literal notranslate"><span class="pre">value</span></code> or <code class="docutils literal notranslate"><span class="pre">dtype</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#name"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#doc"><code class="docutils literal notranslate"><span class="pre">doc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#alarm-group"><code class="docutils literal notranslate"><span class="pre">alarm_group</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#max-length"><code class="docutils literal notranslate"><span class="pre">max_length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#record"><code class="docutils literal notranslate"><span class="pre">record</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#hooks">Hooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-arguments">Other arguments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#supported-data-types">Supported data types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#integers-and-floats">Integers and floats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#strings">Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="#booleans">Booleans</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Hooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#putter-hook">Putter Hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#startup-hook">Startup Hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shutdown-hook">Shutdown Hook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scan-hook">Scan Hook</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id2">API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.pvproperty.html">caproto.server.pvproperty</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#general-tips">General Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#don-t-use-a-getter">Don’t use a getter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why">Why?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reactive-design">Reactive design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#help">Help!</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#my-server-is-saying-high-load">My server is saying “High load”!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#this-warning-says-my-pv-will-take-up-a-considerable-amount-of-memory">This warning says my PV will take up a considerable amount of memory…</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i">How do I…</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#access-async-lib-directly-in-my-class">… access <code class="docutils literal notranslate"><span class="pre">async_lib</span></code> directly in my class?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-every-pv-in-my-group-from-sharing-the-same-alarm">… stop every PV in my group from sharing the same alarm?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#make-a-string-pv-all-i-see-is-an-array-of-numbers">… make a string PV? All I see is an array of numbers!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-an-ioc-when-talking-to-a-real-piece-of-hardware">… structure an IOC when talking to a real piece of hardware?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interact-with-threaded-non-async-code-functions-and-libraries">… interact with threaded/non-async code, functions, and libraries?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-rid-of-pvgroup-and-pvproperty-i-hate-them">… get rid of PVGroup and pvproperty? I hate them!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#represent-both-the-setpoint-and-readback-with-one-pvproperty">… represent both the setpoint and readback with one pvproperty?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.get_pv_pair_wrapper.html">caproto.server.get_pv_pair_wrapper</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#do-some-really-crazy-things-with-caproto">… do some really crazy things with caproto?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handle-records-and-what-are-the-limitations-there">… handle records and what are the limitations there?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-a-client-to-monitor-other-pvs">… add a client to monitor other PVs?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.client_monitor_async.MirrorClientIOC.html">caproto.ioc_examples.client_monitor_async.MirrorClientIOC</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mirror.Mirror.html">caproto.ioc_examples.mirror.Mirror</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#get-custom-arguments-into-my-ioc">… get custom arguments into my IOC?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-macros-and-what-are-macros">… use macros? And what are macros?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#make-a-bunch-of-caproto-iocs-without-all-the-boilerplate">… make a bunch of caproto IOCs without all the boilerplate?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-a-structured-view-of-my-pvgroup-on-the-client-side">… get a structured view of my PVGroup on the client side?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-ioc">Simple IOC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.simple.SimpleIOC.html">caproto.ioc_examples.simple.SimpleIOC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#write-to-a-file-when-a-pv-is-written-to">Write to a File When a PV is Written To</a></li>
<li class="toctree-l3"><a class="reference internal" href="#random-walk">Random Walk</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.random_walk.RandomWalkIOC.html">caproto.ioc_examples.random_walk.RandomWalkIOC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-interrupt">I/O Interrupt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor.html">caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.io_interrupt.IOInterruptIOC.html">caproto.ioc_examples.io_interrupt.IOInterruptIOC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#macros-for-pv-names">Macros for PV names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.macros.MacroifiedNames.html">caproto.ioc_examples.macros.MacroifiedNames</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#subgroups">Subgroups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#records">Records</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.records.RecordMockingIOC.html">caproto.ioc_examples.records.RecordMockingIOC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mini-beamline">Mini-Beamline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.html">caproto.ioc_examples.mini_beamline</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.MiniBeamline.html">caproto.ioc_examples.mini_beamline.MiniBeamline</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.PinHole.html">caproto.ioc_examples.mini_beamline.PinHole</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.Edge.html">caproto.ioc_examples.mini_beamline.Edge</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.Slit.html">caproto.ioc_examples.mini_beamline.Slit</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.MovingDot.html">caproto.ioc_examples.mini_beamline.MovingDot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#more">More…</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.enums.EnumIOC.html">caproto.ioc_examples.enums.EnumIOC</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.autosave.AutosavedSimpleIOC.html">caproto.ioc_examples.autosave.AutosavedSimpleIOC</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.decay.Decay.html">caproto.ioc_examples.decay.Decay</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.ioc_examples.scan_rate.ScanRateIOC.html">caproto.ioc_examples.scan_rate.ScanRateIOC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#helpers">Helpers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#autosave">Autosave</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.autosave.AutosaveHelper.html">caproto.server.autosave.AutosaveHelper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.autosave.RotatingFileManager.html">caproto.server.autosave.RotatingFileManager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#status-statistics">Status / Statistics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.stats.StatusHelper.html">caproto.server.stats.StatusHelper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.stats.BasicStatusHelper.html">caproto.server.stats.BasicStatusHelper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.stats.PeriodicStatusHelper.html">caproto.server.stats.PeriodicStatusHelper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/caproto.server.stats.MemoryTracingHelper.html">caproto.server.stats.MemoryTracingHelper</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookiecutter.html">IOC Template Cookiecutters</a></li>
<li class="toctree-l1"><a class="reference internal" href="own_docs.html">Writing Your Own Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_api.html">Server API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Caproto-in-a-box</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Input-Output Controllers (IOCs)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/iocs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="input-output-controllers-iocs">
<h1>Input-Output Controllers (IOCs)<a class="headerlink" href="#input-output-controllers-iocs" title="Permalink to this heading">¶</a></h1>
<p>EPICS Input-Output Controllers (IOCs) expose an EPICS server. Behind the
server, they may connect to a device driver, data-processing code, and/or
an EPICS client for chaining with other servers.</p>
<p>In this section, we will review some of the example IOCs that are included with
caproto, intended as demonstrations of what is possible.</p>
<section id="why-write-an-ioc-using-caproto">
<h2>Why Write an IOC Using Caproto?<a class="headerlink" href="#why-write-an-ioc-using-caproto" title="Permalink to this heading">¶</a></h2>
<p>Caproto makes it is easy to launch a protocol-compliant Channel Access server
in just a couple lines of Python. This opens up some interesting possibilities:</p>
<ul class="simple">
<li><p>In Python, it is easy to invoke standard web protocols. For example, writing
an EPICS server around a device that speaks JSON may be easier with caproto
than with any previously-existing tools.</p></li>
<li><p>Many scientists who rely on EPICS but may not understand the details of
EPICS already know some Python for the data analysis work. Caproto may make
it easier for scientists and controls engineers to collaborate.</p></li>
<li><p>As with its clients, caproto’s servers handle a human-friendly encapsulation
of every message sent and received, which can be valuable for development,
logging, and debugging.</p></li>
</ul>
<p>Take a look around
<a class="reference external" href="https://github.com/caproto/caproto/tree/master/caproto/ioc_examples">the ioc_examples subpackage</a> for
more examples not covered in this document.</p>
</section>
<section id="using-the-ioc-examples">
<h2>Using the IOC Examples<a class="headerlink" href="#using-the-ioc-examples" title="Permalink to this heading">¶</a></h2>
<p>They can be started like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.simple
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:51:09.751<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:51:09.752<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:54966
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:51:09.753<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
</pre></div>
</div>
<p>and stopped using Ctrl+C:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>^C
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:51:10.828<span class="w"> </span>server:129<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>task<span class="w"> </span>cancelled.<span class="w"> </span>Must<span class="w"> </span>shut<span class="w"> </span>down.
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:51:10.828<span class="w"> </span>server:132<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>exiting....
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--list-pvs</span></code> to display which PVs they serve:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.simple<span class="w"> </span>--list-pvs
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:52:36.087<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:52:36.089<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:62005
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:52:36.089<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:52:36.089<span class="w"> </span>server:123<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>simple:A
<span class="w">    </span>simple:B
<span class="w">    </span>simple:C
</pre></div>
</div>
<p>and use <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> to conveniently customize the PV prefix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.simple<span class="w"> </span>--list-pvs<span class="w"> </span>--prefix<span class="w"> </span>my_custom_prefix:
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:54:14.528<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:54:14.530<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:55810
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:54:14.530<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">16</span>:54:14.530<span class="w"> </span>server:123<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>my_custom_prefix:A
<span class="w">    </span>my_custom_prefix:B
<span class="w">    </span>my_custom_prefix:C
</pre></div>
</div>
<p>Type <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">caproto.ioc_examples.simple</span> <span class="pre">-h</span></code> for more options.</p>
</section>
<section id="pvgroup">
<h2>PVGroup<a class="headerlink" href="#pvgroup" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="generated/caproto.server.PVGroup.html#caproto.server.PVGroup" title="caproto.server.PVGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">PVGroup</span></code></a> is a container for <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code>
instances which determine how to represent the group’s contents as EPICS
process variables (PVs).</p>
<p>You are expected to subclass from <code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> to implement your own IOCs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">pvproperty</span>

<span class="k">class</span> <span class="nc">BasicIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">my_pv</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;My test PV&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>caproto uses your class definition and performs magic under the hood to create
a simple PV name to <code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelData</span></code> instances.  See what
happens when you instantiate the above:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">ioc</span> <span class="o">=</span> <span class="n">BasicIOC</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;prefix:&#39;</span><span class="p">)</span>

<span class="gp">In [2]: </span><span class="nb">dict</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">)</span>
<span class="gh">Out[2]: </span><span class="go">{&#39;prefix:my_pv&#39;: &lt;caproto.server.server.PvpropertyInteger at 0x7fe5c069f910&gt;}</span>
</pre></div>
</div>
<p>This simple dictionary database is what will be used to start your server.
Adding on some boilerplate to help you parse command-line arguments and pick
an async library backend to use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>
<span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
    <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;prefix:&#39;</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Basic IOC&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ioc</span> <span class="o">=</span> <span class="n">BasicIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<p>The above would allow you to access <code class="docutils literal notranslate"><span class="pre">prefix:my_pv</span></code> over Channel Access.</p>
<section id="group-write">
<h3>group_write<a class="headerlink" href="#group-write" title="Permalink to this heading">¶</a></h3>
<p>By default, if an explicit putter hook is not supplied for a given
<cite>.pvproperty</cite>, an implicit one defined in the group will be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">group_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generic write called for channels without `put` defined.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">pvspec</span><span class="o">.</span><span class="n">attr</span><span class="si">}</span><span class="s2"> was written to with </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be used to generically handle or modify the put handling of
any pvproperty in the group.</p>
</section>
<section id="alarms">
<h3>Alarms<a class="headerlink" href="#alarms" title="Permalink to this heading">¶</a></h3>
<p>PVGroup by default has an <code class="docutils literal notranslate"><span class="pre">alarms</span></code> attribute which is defined as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alarms</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">ChannelAlarm</span><span class="p">)</span>
</pre></div>
</div>
<p>Individual <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> instances specify their alarm instance as keys of
this dictionary.  That is,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alarm_group</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>means that <code class="docutils literal notranslate"><span class="pre">my_property</span></code> will join the “primary” alarm group, or the
instance from</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pvgroup_instance</span><span class="o">.</span><span class="n">alarms</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>While this is not required to be a string, it is recommended to do so by
convention.</p>
<p>Note that when <code class="docutils literal notranslate"><span class="pre">alarm_group</span></code> is unspecified, pvproperties in a given PVGroup
instance share the same alarm instance - as their key to the above dictionary
is left at the default value. This is usually a reasonable guess for small
groups of PVs.</p>
</section>
<section id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.PVGroup.html#caproto.server.PVGroup" title="caproto.server.PVGroup"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.server.PVGroup</span></code></a>(prefix, *[, macros, ...])</p></td>
<td><p>Class which groups a set of PVs for a high-level caproto server</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pvproperty">
<h2>pvproperty<a class="headerlink" href="#pvproperty" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> combines information as to how to represent your information
over EPICS Channel Access and provides easy-to-use hooks for reacting to
certain events – by hooking user-provided Python methods.</p>
<section id="basic-configuration">
<h3>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this heading">¶</a></h3>
<p>Only one keyword argument is truly required: either <code class="docutils literal notranslate"><span class="pre">value</span></code> or <code class="docutils literal notranslate"><span class="pre">dtype</span></code>.</p>
<section id="value-or-dtype">
<h4><code class="docutils literal notranslate"><span class="pre">value</span></code> or <code class="docutils literal notranslate"><span class="pre">dtype</span></code><a class="headerlink" href="#value-or-dtype" title="Permalink to this heading">¶</a></h4>
<p>If you specify a <code class="docutils literal notranslate"><span class="pre">value</span></code> keyword argument, the <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> will assume its
data type based on the supported data types table.  That is, if you give a
value of <code class="docutils literal notranslate"><span class="pre">1</span></code>, dtype will be assumed to be <code class="docutils literal notranslate"><span class="pre">int</span></code> and the pvproperty will
produce a <a class="reference internal" href="generated/caproto.server.PvpropertyInteger.html#caproto.server.PvpropertyInteger" title="caproto.server.PvpropertyInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyInteger</span></code></a> (<a class="reference internal" href="generated/caproto.ChannelInteger.html#caproto.ChannelInteger" title="caproto.ChannelInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelInteger</span></code></a>).</p>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">dtype</span></code> may be specified directly as either a <cite>ChannelType</cite>
such as <code class="docutils literal notranslate"><span class="pre">dtype=ChannelType.LONG</span></code> or equivalently the built-in Python type
<code class="docutils literal notranslate"><span class="pre">dtype=int</span></code>.  The default value will be chosen from the PVGroup’s
<code class="docutils literal notranslate"><span class="pre">default_values</span></code> dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">str</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nb">float</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="nb">bool</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

        <span class="n">ChannelType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">INT</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">LONG</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">ENUM</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">ChannelType</span><span class="o">.</span><span class="n">CHAR</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="name">
<h4><code class="docutils literal notranslate"><span class="pre">name</span></code><a class="headerlink" href="#name" title="Permalink to this heading">¶</a></h4>
<p>Properties in Python are a bit magical in their own right - <code class="docutils literal notranslate"><span class="pre">property</span></code>, when
defined on a class, is aware of the name you have given it (by way of the
<code class="docutils literal notranslate"><span class="pre">descriptor</span></code> protocol).</p>
<p>This means that <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> can give a reasonable default for its PV name.
You are free to customize this, however, by specifying <code class="docutils literal notranslate"><span class="pre">name=&quot;PV:SUFFIX&quot;</span></code>
where <code class="docutils literal notranslate"><span class="pre">PV:SUFFIX</span></code> is your desired suffix to be appended to the parent
<code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> prefix.</p>
</section>
<section id="doc">
<h4><code class="docutils literal notranslate"><span class="pre">doc</span></code><a class="headerlink" href="#doc" title="Permalink to this heading">¶</a></h4>
<p>Please consider documenting what each individual property does by adding a
human-understandable explanation string to the <code class="docutils literal notranslate"><span class="pre">doc</span></code> keyword argument.</p>
<p>This will be picked up by automatic documentation generation utilities
and added to its parent group’s <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> table.</p>
<p>Also, if using a <code class="docutils literal notranslate"><span class="pre">record</span></code>, your <code class="docutils literal notranslate"><span class="pre">doc</span></code> string will automatically be sent
over EPICS with the <code class="docutils literal notranslate"><span class="pre">.DESC</span></code> field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;My property&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>caget<span class="w"> </span>prefix:my_property.DESC
prefix:my_property.DESC<span class="w">        </span>My<span class="w"> </span>property
</pre></div>
</div>
</section>
<section id="alarm-group">
<h4><code class="docutils literal notranslate"><span class="pre">alarm_group</span></code><a class="headerlink" href="#alarm-group" title="Permalink to this heading">¶</a></h4>
<p>By default, pvproperties in a given PVGroup instance share the same alarm
instance.</p>
<p>This is usually a reasonable guess for small groups of PVs.  For finer-grained
customization, the easiest way to change this functionality is to specify a
per-pvproperty alarm group using the <code class="docutils literal notranslate"><span class="pre">alarm_group</span></code> keyword argument.  It
expects a string identifier, which should be reused on all other pvproperties
that are to share the alarm instance.</p>
</section>
<section id="max-length">
<h4><code class="docutils literal notranslate"><span class="pre">max_length</span></code><a class="headerlink" href="#max-length" title="Permalink to this heading">¶</a></h4>
<p>This is the length of the array (when used with integers, floats) or the
number of characters in a character or byte string.</p>
<p>By default, it will be the length of the <code class="docutils literal notranslate"><span class="pre">value</span></code> that is passed in - or <code class="docutils literal notranslate"><span class="pre">1</span></code>
for scalar values.</p>
<p>EPICS clients expect to know the maximum length of an array at connection
time and may not properly handle it changing dynamically.  As such,
<code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> allows you to customize the size at property definition-time.</p>
</section>
<section id="record">
<h4><code class="docutils literal notranslate"><span class="pre">record</span></code><a class="headerlink" href="#record" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> allows you to pretend your value has common EPICS record fields.
For example, it is possible to report a given property as an analog input
(<code class="docutils literal notranslate"><span class="pre">ai</span></code>) record:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;My property&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>More on this in a later section.</p>
</section>
<section id="hooks">
<h4>Hooks<a class="headerlink" href="#hooks" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">put</span></code>, <code class="docutils literal notranslate"><span class="pre">startup</span></code>, <code class="docutils literal notranslate"><span class="pre">shutdown</span></code>, <code class="docutils literal notranslate"><span class="pre">scan</span></code> may be passed in directly with
the <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> for reuse among multiple properties or to avoid the
decorator syntax (the generally preferred syntax, shown in detail in later
sections).</p>
<p>This can look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">write_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pv_a</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">single_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The first PV&quot;</span><span class="p">)</span>
<span class="n">pv_b</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">single_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The second PV&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="other-arguments">
<h4>Other arguments<a class="headerlink" href="#other-arguments" title="Permalink to this heading">¶</a></h4>
<p>Other arguments will be passed to the <code class="docutils literal notranslate"><span class="pre">ChannelData</span></code> instance as-is.   For
example, these allow you to customize special classes such as <code class="docutils literal notranslate"><span class="pre">ChannelEnum</span></code>
which may take in <code class="docutils literal notranslate"><span class="pre">enum_strings</span></code> - which would, of course, be unacceptable
for a floating point value.</p>
</section>
</section>
<section id="supported-data-types">
<h3>Supported data types<a class="headerlink" href="#supported-data-types" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">value</span></code> may be an instance of one of the following, or <code class="docutils literal notranslate"><span class="pre">dtype</span></code> may be
one of the following types:</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">Built-in Data Type Mapping</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Data Type</p></th>
<th class="head"><p>Data Class</p></th>
<th class="head"><p>Inherits from</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>str</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyChar.html#caproto.server.PvpropertyChar" title="caproto.server.PvpropertyChar"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyChar</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelChar.html#caproto.ChannelChar" title="caproto.ChannelChar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelChar</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>bytes</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyByte.html#caproto.server.PvpropertyByte" title="caproto.server.PvpropertyByte"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyByte</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelByte.html#caproto.ChannelByte" title="caproto.ChannelByte"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelByte</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>int</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyInteger.html#caproto.server.PvpropertyInteger" title="caproto.server.PvpropertyInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyInteger</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelInteger.html#caproto.ChannelInteger" title="caproto.ChannelInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelInteger</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>float</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyDouble.html#caproto.server.PvpropertyDouble" title="caproto.server.PvpropertyDouble"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyDouble</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelDouble.html#caproto.ChannelDouble" title="caproto.ChannelDouble"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelDouble</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>bool</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyBoolEnum.html#caproto.server.PvpropertyBoolEnum" title="caproto.server.PvpropertyBoolEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyBoolEnum</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelEnum.html#caproto.ChannelEnum" title="caproto.ChannelEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelEnum</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>enum.IntEnum</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyEnum.html#caproto.server.PvpropertyEnum" title="caproto.server.PvpropertyEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyEnum</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelEnum.html#caproto.ChannelEnum" title="caproto.ChannelEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelEnum</span></code></a></p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">dtype</span></code> may be omitted when a value is specified.</p>
<p>If you desire finer-grained control over the data type provided (e.g., you
specifically want a 32-bit float instead of a 64-bit double), you may
use the appropriate <cite>ChannelType</cite> directly:</p>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">ChannelType Mapping</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Data Type</p></th>
<th class="head"><p>Data Class</p></th>
<th class="head"><p>Inherits from</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ChannelType.STRING</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyString.html#caproto.server.PvpropertyString" title="caproto.server.PvpropertyString"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyString</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelString.html#caproto.ChannelString" title="caproto.ChannelString"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelString</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>ChannelType.INT</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyShort.html#caproto.server.PvpropertyShort" title="caproto.server.PvpropertyShort"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyShort</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelShort.html#caproto.ChannelShort" title="caproto.ChannelShort"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelShort</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>ChannelType.LONG</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyInteger.html#caproto.server.PvpropertyInteger" title="caproto.server.PvpropertyInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyInteger</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelInteger.html#caproto.ChannelInteger" title="caproto.ChannelInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelInteger</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>ChannelType.DOUBLE</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyDouble.html#caproto.server.PvpropertyDouble" title="caproto.server.PvpropertyDouble"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyDouble</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelDouble.html#caproto.ChannelDouble" title="caproto.ChannelDouble"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelDouble</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>ChannelType.FLOAT</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyFloat.html#caproto.server.PvpropertyFloat" title="caproto.server.PvpropertyFloat"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyFloat</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelFloat.html#caproto.ChannelFloat" title="caproto.ChannelFloat"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelFloat</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>ChannelType.ENUM</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyEnum.html#caproto.server.PvpropertyEnum" title="caproto.server.PvpropertyEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyEnum</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelEnum.html#caproto.ChannelEnum" title="caproto.ChannelEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelEnum</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>ChannelType.CHAR</p></td>
<td><p><a class="reference internal" href="generated/caproto.server.PvpropertyChar.html#caproto.server.PvpropertyChar" title="caproto.server.PvpropertyChar"><code class="xref py py-class docutils literal notranslate"><span class="pre">PvpropertyChar</span></code></a></p></td>
<td><p><a class="reference internal" href="generated/caproto.ChannelChar.html#caproto.ChannelChar" title="caproto.ChannelChar"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChannelChar</span></code></a></p></td>
</tr>
</tbody>
</table>
<section id="integers-and-floats">
<h4>Integers and floats<a class="headerlink" href="#integers-and-floats" title="Permalink to this heading">¶</a></h4>
<p>Integer and floating point values by default map to the largest containers
in EPICS - 32-bit integers and 64-bit floats, respectively.</p>
</section>
<section id="strings">
<h4>Strings<a class="headerlink" href="#strings" title="Permalink to this heading">¶</a></h4>
<p>Strings are a bit complicated when it comes to EPICS and caproto follows suit.</p>
<p>At minimum, the following will work to store up to 40 character strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_string</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
    <span class="c1"># The default value:</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;String value&quot;</span><span class="p">,</span>
    <span class="c1"># Document it!</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Indicator as to what this does.&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>A more complete specification looks like the following. See the “how to”
section below for more details on why the following is the preferred method for
strings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_string</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
    <span class="c1"># The default value:</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;String value&quot;</span><span class="p">,</span>
    <span class="c1"># Document it!</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Indicator as to what this does.&quot;</span><span class="p">,</span>
    <span class="c1"># Configure the PV suffix, if different than ``my_string``:</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;:PV:SUFFIX&quot;</span><span class="p">,</span>
    <span class="c1"># Optionally configure the encoding:</span>
    <span class="n">string_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="c1"># Ensure that this is marked as &quot;report_as_string&quot; (** optional)</span>
    <span class="n">report_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Optionally specify how long the string can get - the default is</span>
    <span class="c1"># the length of the provided value.</span>
    <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this heading">¶</a></h4>
<p>A new syntax for specifying enums using built-in <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a> is
recommended:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">pvproperty</span>
<span class="kn">import</span> <span class="nn">enum</span>


<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">on</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">unknown</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">my_enum</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">MyEnum</span><span class="o">.</span><span class="n">on</span><span class="p">,</span>
        <span class="n">record</span><span class="o">=</span><span class="s1">&#39;mbbi&#39;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;An enum with off/on/unknown, and mbbi record fields.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you may specify the strings manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">caproto</span> <span class="kn">import</span> <span class="n">ChannelType</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">pvproperty</span>

<span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">my_enum</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s1">&#39;on&#39;</span><span class="p">,</span>
        <span class="n">enum_strings</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">ChannelType</span><span class="o">.</span><span class="n">ENUM</span><span class="p">,</span>
        <span class="n">record</span><span class="o">=</span><span class="s1">&#39;mbbi&#39;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;An enum with off/on/unknown, and mbbi record fields.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>For the above mbbi records, the <code class="docutils literal notranslate"><span class="pre">ZRST</span></code> (zero string) field, <code class="docutils literal notranslate"><span class="pre">ONST</span></code> (one
string) field, and so on (up to 15), are similarly respected and mapped from
the enum strings (keyword argument or <code class="docutils literal notranslate"><span class="pre">IntEnum</span></code> class).</p>
</section>
<section id="booleans">
<h4>Booleans<a class="headerlink" href="#booleans" title="Permalink to this heading">¶</a></h4>
<p>Boolean values map to an enum type, with “Off” and “On” as the default
strings.</p>
<p>When using either the <code class="docutils literal notranslate"><span class="pre">bi</span></code> or <code class="docutils literal notranslate"><span class="pre">bo</span></code> records, the <code class="docutils literal notranslate"><span class="pre">ZNAM</span></code> and <code class="docutils literal notranslate"><span class="pre">ONAM</span></code>
fields are automatically populated with the string equivalent values for 0 and
1.  These are derived from the <code class="docutils literal notranslate"><span class="pre">enum_strings</span></code> keyword argument.</p>
</section>
</section>
<section id="id1">
<h3>Hooks<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>Hooks allow you to react to certain events that happen during the life of
the IOC by providing your own methods.</p>
<section id="putter-hook">
<h4>Putter Hook<a class="headerlink" href="#putter-hook" title="Permalink to this heading">¶</a></h4>
<p>This is the most common hook you will need when writing a caproto-based IOC.</p>
<p>The “putter” associated with a <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> is called whenever a user writes
to the associated PV through any client (<code class="docutils literal notranslate"><span class="pre">caput</span></code>, <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code>, pyepics,
caproto clients, and so on) and also when you write directly to it in code.</p>
<p>An example of usage and the required method signature is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@my_property</span><span class="o">.</span><span class="n">putter</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Startup hook for ``my_property``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``my_property``.</span>

<span class="sd">    value :</span>
<span class="sd">        This is the value the client wrote to the PV.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    value :</span>
<span class="sd">        You may optionally change the value before committing it into</span>
<span class="sd">        the underlying ChannelData instance.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    SkipWrite</span>
<span class="sd">        Raise this to skip further processing of the write.</span>

<span class="sd">    Exception</span>
<span class="sd">        When an unhandled error occurs.  Alarm will be set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that in the above, <code class="docutils literal notranslate"><span class="pre">self</span></code> will refer to the <code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> instance.
It will allow you to access the values of other PVs in the group, or any
other state held within.</p>
<p><code class="docutils literal notranslate"><span class="pre">instance</span></code> here is the ChannelData-based instance of <code class="docutils literal notranslate"><span class="pre">my_property</span></code>.
It is exactly equivalent to <code class="docutils literal notranslate"><span class="pre">self.my_property</span></code> in the above example.  This
object holds the current value, alarm instance, and other associated metadata.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">putter</span></code> methods may be reused among any number of <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code>
instances, this parameter can be used generically in such scenarios.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">value</span></code> can be assumed to be consistent with the data type of
<code class="docutils literal notranslate"><span class="pre">my_property</span></code>.  In the above case, this is <code class="docutils literal notranslate"><span class="pre">int</span></code> (as <code class="docutils literal notranslate"><span class="pre">0</span></code> is an integer).</p>
<p>You may optionally change the value before committing it into the underlying
ChannelData instance.  If this is needed, return the modified value here.
Otherwise, the implicit value of <code class="docutils literal notranslate"><span class="pre">None</span></code> means to accept the value as-is.</p>
<p>Additionally, you may completely reject the write entirely by raising the
<cite>.SkipWrite</cite> exception.  This is a non-error exception which will leave the
previously-stored value intact.</p>
</section>
<section id="startup-hook">
<h4>Startup Hook<a class="headerlink" href="#startup-hook" title="Permalink to this heading">¶</a></h4>
<p>This hook is executed when the IOC starts up.</p>
<p>An example of usage and the required method signature is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@my_property</span><span class="o">.</span><span class="n">startup</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Startup hook for ``my_property``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``my_property``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that in the above, <code class="docutils literal notranslate"><span class="pre">self</span></code> will refer to the <code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> instance.
It will allow you to access the values of other PVs in the group, or any
other state held within.</p>
<p>Second, notice that <code class="docutils literal notranslate"><span class="pre">my_property</span></code> is repeated multiple times:  the decorator
must use <code class="docutils literal notranslate"><span class="pre">my_property.startup</span></code> to define the startup method, and the
method itself must be named <code class="docutils literal notranslate"><span class="pre">my_property</span></code>.  This is due to how decorators
function and mirrors what you would see with a standard Python <code class="docutils literal notranslate"><span class="pre">property</span></code>.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">async_lib</span></code> can be used to abstract away the async library
layer that is in use.  It is considered good practice to use, for example,
<code class="docutils literal notranslate"><span class="pre">async_lib.sleep</span></code> instead of <code class="docutils literal notranslate"><span class="pre">asyncio.sleep</span></code> – or similarly
<code class="docutils literal notranslate"><span class="pre">trio.sleep</span></code>, <code class="docutils literal notranslate"><span class="pre">curio.sleep</span></code>.  This will allow your IOC to work no matter if
you decide to use asyncio, curio, or trio as your async library.</p>
</section>
<section id="shutdown-hook">
<h4>Shutdown Hook<a class="headerlink" href="#shutdown-hook" title="Permalink to this heading">¶</a></h4>
<p>This hook is executed when the IOC shuts down.</p>
<p>An example of usage and the required method signature is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@my_property</span><span class="o">.</span><span class="n">shutdown</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shutdown hook for ``my_property``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``my_property``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>See the startup hook section above for more details on what these parameters
mean.</p>
</section>
<section id="scan-hook">
<h4>Scan Hook<a class="headerlink" href="#scan-hook" title="Permalink to this heading">¶</a></h4>
<p>This hook is executed periodically, with the exact rate depending on its
configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@my_property</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan hook for ``my_property``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``my_property``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>See the startup hook section above for more details on what these parameters
mean.</p>
<p><cite>.scan_wrapper</cite> arguments can be passed to <code class="docutils literal notranslate"><span class="pre">my_property.scan(...)</span></code> above
to further customize how the routine is called.  For example, it is possible
to stop the scan routine when an exception happens (<code class="docutils literal notranslate"><span class="pre">stop_on_error=True</span></code>)
or let users put to the <code class="docutils literal notranslate"><span class="pre">.SCAN</span></code> field (when using <code class="docutils literal notranslate"><span class="pre">record=&quot;...&quot;</span></code>) to
change the rate to common EPICS-defined ones.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.scan_wrapper.html#caproto.server.scan_wrapper" title="caproto.server.scan_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.server.scan_wrapper</span></code></a>(scan_function, ...)</p></td>
<td><p>Wrap a function intended for <cite>pvproperty.scan</cite> with common logic to periodically call it.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id2">
<h3>API<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.pvproperty.html#caproto.server.pvproperty" title="caproto.server.pvproperty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.server.pvproperty</span></code></a>([get, put, ...])</p></td>
<td><p>A property-like descriptor for specifying a PV in a <cite>PVGroup</cite>.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="general-tips">
<h2>General Tips<a class="headerlink" href="#general-tips" title="Permalink to this heading">¶</a></h2>
<section id="don-t-use-a-getter">
<h3>Don’t use a getter<a class="headerlink" href="#don-t-use-a-getter" title="Permalink to this heading">¶</a></h3>
<p>Generally speaking, you should not define a getter. This goes back to original
design decisions for how <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> instances could work. The authors
now know that this was a mistake to make easily accessible.</p>
<section id="why">
<h4>Why?<a class="headerlink" href="#why" title="Permalink to this heading">¶</a></h4>
<p>Inclusion of a getter can unfortunately make value monitoring less intuitive at
best, or break its functionality at worst.</p>
<p>There is no way to monitor such a value for changes, as it requires calling
the getter to determine the current value.</p>
<p>Each time a user runs <code class="docutils literal notranslate"><span class="pre">caget</span> <span class="pre">YOUR:PV</span></code>, the getter will be called. If the
getter performs a write to update the instance, all other clients watching
<code class="docutils literal notranslate"><span class="pre">YOUR:PV</span></code> will then see an update. The more clients added to the mix, the
more frequent that other clients will see updates - seemingly at arbitrary
times.</p>
</section>
</section>
<section id="reactive-design">
<h3>Reactive design<a class="headerlink" href="#reactive-design" title="Permalink to this heading">¶</a></h3>
<p>Most of what your IOC does should be in response to what the user requests by
way of <code class="docutils literal notranslate"><span class="pre">putter</span></code> hooks.</p>
<p>Periodic updates should happen in <code class="docutils literal notranslate"><span class="pre">scan</span></code> loops.</p>
<p>If PVGroup data is sourced from a database, real device, website, etc,
then a different approach may be more appropriate.  See below in the “how do I”
section.</p>
</section>
</section>
<section id="help">
<h2>Help!<a class="headerlink" href="#help" title="Permalink to this heading">¶</a></h2>
<section id="my-server-is-saying-high-load">
<h3>My server is saying “High load”!<a class="headerlink" href="#my-server-is-saying-high-load" title="Permalink to this heading">¶</a></h3>
<p>You may have a real issue in your code, or you may have clients which are
saturating your server with requests.</p>
<p>Take a look at your code and see that you don’t have any synchronous (i.e.,
threaded) code being run in your async functions.  This is really important.
Defer it to an executor and you can avoid further headaches: see
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor">here</a>.</p>
<p>If you just have a lot of clients hitting your server without any apparent
negative effect, you can customize caproto’s server settings to not display
this message.</p>
</section>
<section id="this-warning-says-my-pv-will-take-up-a-considerable-amount-of-memory">
<h3>This warning says my PV will take up a considerable amount of memory…<a class="headerlink" href="#this-warning-says-my-pv-will-take-up-a-considerable-amount-of-memory" title="Permalink to this heading">¶</a></h3>
<p>It’s probably true and it’s there to save you from the default settings.</p>
<p>You may either set <code class="docutils literal notranslate"><span class="pre">max_subscription_backlog</span></code> for each of your big PVs
manually, or let caproto tweak it for you in an automated fashion.</p>
<p>See the environment variable section for details on what each variable means.</p>
</section>
</section>
<section id="how-do-i">
<h2>How do I…<a class="headerlink" href="#how-do-i" title="Permalink to this heading">¶</a></h2>
<section id="access-async-lib-directly-in-my-class">
<h3>… access <code class="docutils literal notranslate"><span class="pre">async_lib</span></code> directly in my class?<a class="headerlink" href="#access-async-lib-directly-in-my-class" title="Permalink to this heading">¶</a></h3>
<p>If you have any startup hooks defined, you can stash <code class="docutils literal notranslate"><span class="pre">async_lib</span></code> there.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">thing</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;An integer-valued PV.&quot;</span><span class="p">)</span>

<span class="nd">@thing</span><span class="o">.</span><span class="n">startup</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">thing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">async_lib</span> <span class="o">=</span> <span class="n">async_lib</span>
</pre></div>
</div>
<p>Or more generally, you can pass a <code class="docutils literal notranslate"><span class="pre">startup_hook</span></code> independent of any
<code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> by way of <code class="docutils literal notranslate"><span class="pre">run()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StartupAndShutdown</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">__ainit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;1. The IOC-level startup_hook from `run()` was called.&quot;</span><span class="p">)</span>
        <span class="c1"># Note that we have to pass this in to ``run()``!</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;simple:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Run an IOC that prints on startup and shutdown.&quot;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">StartupAndShutdown</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="n">startup_hook</span><span class="o">=</span><span class="n">ioc</span><span class="o">.</span><span class="n">__ainit__</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<p>As an convention, consider naming your method <code class="docutils literal notranslate"><span class="pre">__ainit__</span></code>.</p>
<p>See the full IOC example in <code class="docutils literal notranslate"><span class="pre">startup_and_shutdown_hooks</span></code>.</p>
</section>
<section id="stop-every-pv-in-my-group-from-sharing-the-same-alarm">
<h3>… stop every PV in my group from sharing the same alarm?<a class="headerlink" href="#stop-every-pv-in-my-group-from-sharing-the-same-alarm" title="Permalink to this heading">¶</a></h3>
<p>By default, pvproperties in a given PVGroup instance share the same alarm
instance. This is usually a reasonable guess for small groups of PVs.  For
finer-grained customization, the easiest way to change this functionality is to
specify a per-pvproperty alarm group using the <code class="docutils literal notranslate"><span class="pre">alarm_group</span></code> keyword
argument.  It expects a string identifier, which should be reused on all other
pvproperties that are expected to use the same alarm instance.</p>
</section>
<section id="make-a-string-pv-all-i-see-is-an-array-of-numbers">
<h3>… make a string PV? All I see is an array of numbers!<a class="headerlink" href="#make-a-string-pv-all-i-see-is-an-array-of-numbers" title="Permalink to this heading">¶</a></h3>
<p>If you have a short string that can fit into the EPICS definition of
<code class="docutils literal notranslate"><span class="pre">DBR_STRING</span></code> - a maximum length of <code class="docutils literal notranslate"><span class="pre">MAX_STRING_SIZE</span> <span class="pre">=</span> <span class="pre">40</span></code> - you can use
the following and not worry about anything further:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
    <span class="c1"># The default value:</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;String value&quot;</span><span class="p">,</span>
    <span class="c1"># Specify STRING as the data type - otherwise CHAR will be chosen:</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">ChannelType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="c1"># Document what the property is for:</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Indicator as to what this does.&quot;</span><span class="p">,</span>
    <span class="c1"># Optionally specify the encoding, if necessary:</span>
    <span class="n">string_encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There is a convention you may not have heard about, what caproto refers to as
long string support, in which <code class="docutils literal notranslate"><span class="pre">DBR_STRING</span></code> values can be longer than 40
characters when <strong>clients</strong> append a special character to the PV name:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>caget<span class="w"> </span>-S<span class="w"> </span>my_property.$<span class="w"> </span>my_property.VAL$
my_property.$<span class="w"> </span>String<span class="w"> </span>value
my_property.VAL$<span class="w"> </span>String<span class="w"> </span>value

$<span class="w"> </span>caput<span class="w"> </span>-S<span class="w"> </span>my_property.VAL$<span class="w"> </span><span class="m">1234567890123456789012345678901234567890123456789012345678901234567890</span>
Old<span class="w"> </span>:<span class="w"> </span>my_property.VAL$<span class="w"> </span>String<span class="w"> </span>value
New<span class="w"> </span>my_property.VAL$<span class="w"> </span><span class="m">1234567890123456789012345678901234567890123456789012345678901234567890</span>
</pre></div>
</div>
<p>Note that the last string is 70 characters long.  What happens if we request it
as a regular string without the long string modifier now?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>caget<span class="w"> </span>my_property
my_property<span class="w">       </span><span class="m">1234567890123456789012345678901234567890</span>
</pre></div>
</div>
<p>… it’s truncated to only 40 characters! There’s not much we can do about it,
so clients should just be configured to use the custom modifier.</p>
<p>As an alternative, <a class="reference internal" href="generated/caproto.server.pvproperty.html#caproto.server.pvproperty" title="caproto.server.pvproperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">pvproperty</span></code></a> supports arrays of <code class="docutils literal notranslate"><span class="pre">DBR_CHAR</span></code>
which are signed, 8-bit numbers, meaning its values fall in the inclusive range
of [-127, 127].  These can also be used to represent arbitrarily long strings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_property</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
    <span class="c1"># The default value:</span>
    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;String value&quot;</span><span class="p">,</span>
    <span class="c1"># Document it!</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Indicator as to what this does.&quot;</span><span class="p">,</span>
    <span class="c1"># Optionally configure the encoding:</span>
    <span class="n">string_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="c1"># Ensure that this is marked as &quot;report_as_string&quot; (** optional)</span>
    <span class="n">report_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Optionally specify how long the string can get - the default is</span>
    <span class="c1"># the length of the provided value.</span>
    <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Please note that you will still have to use the special long string modifier
<code class="docutils literal notranslate"><span class="pre">.$</span></code> to have this work with <code class="docutils literal notranslate"><span class="pre">caget</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">report_as_string=True</span></code> is optional here, but it makes it function more
closely to the first example provided in this section.  You can access up
to the first 40 characters of the string without any special modifiers to
<code class="docutils literal notranslate"><span class="pre">caget</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code>, or <code class="docutils literal notranslate"><span class="pre">caproto-get</span></code> and <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code>.</p>
</section>
<section id="structure-an-ioc-when-talking-to-a-real-piece-of-hardware">
<h3>… structure an IOC when talking to a real piece of hardware?<a class="headerlink" href="#structure-an-ioc-when-talking-to-a-real-piece-of-hardware" title="Permalink to this heading">¶</a></h3>
<p>When talking to a single device and requesting a bunch of different information
from it to update a single <code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> to represent its status, we recommend
the inclusion of a polling loop.</p>
<p>For a simple “query device and update state”-style group, this could look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">update_hook</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;bi&#39;</span><span class="p">)</span>

<span class="nd">@update_hook</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">use_scan_field</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan hook for ``update_hook``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``update_hook``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Reach out to the device asynchronously and get back information:</span>
    <span class="n">device_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">query_device</span><span class="p">()</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">value1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">device_info</span><span class="p">[</span><span class="s2">&quot;value1&quot;</span><span class="p">])</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">value2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">device_info</span><span class="p">[</span><span class="s2">&quot;value2&quot;</span><span class="p">])</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">value3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">device_info</span><span class="p">[</span><span class="s2">&quot;value3&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>With the above, the client has some control over how fast the updates happen.
If that’s undesirable, set <code class="docutils literal notranslate"><span class="pre">period=desired_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">use_scan_field=False</span></code></p>
<p>If you don’t have an async-capable interface, there will be some additional
work required.  Consider using async_lib queues for this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">update_hook</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;bi&#39;</span><span class="p">)</span>

<span class="nd">@update_hook</span><span class="o">.</span><span class="n">startup</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Startup hook for ``update_hook``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``update_hook``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">ThreadsafeQueue</span><span class="p">()</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">my_threaded_function</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">))</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># or perhaps thread.is_alive()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">async_get</span><span class="p">()</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;prop&quot;</span><span class="p">])</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># perform cleanup here</span>
</pre></div>
</div>
<p>If, instead, you have a bunch of knobs that the user can set with some
control flow decisions to make, instead consider something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">update_hook</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;bi&#39;</span><span class="p">)</span>

<span class="nd">@update_hook</span><span class="o">.</span><span class="n">startup</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Startup hook for ``update_hook``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    instance : ChannelData</span>
<span class="sd">        This is the instance of ``update_hook``.</span>

<span class="sd">    async_lib : AsyncLibraryLayer</span>
<span class="sd">        This is a shim layer for {asyncio, curio, trio} that you can use</span>
<span class="sd">        to make async library-agnostic IOCs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">device_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">query_device</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">value1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">device_info</span><span class="p">[</span><span class="s2">&quot;value1&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_requested</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;move&#39;</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_move</span><span class="p">()</span>
        <span class="o">...</span>
        <span class="k">await</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">update_delay</span><span class="p">)</span>
</pre></div>
</div>
<p>A more concrete example with aiohttp:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@update_hook</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_server_state</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_download</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_and_update</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">,</span>
                <span class="n">aiohttp</span><span class="o">.</span><span class="n">client_exceptions</span><span class="o">.</span><span class="n">ClientConnectorError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_consecutive_timeouts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timeout while updating server (</span><span class="si">%d</span><span class="s1"> in a row)&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_consecutive_timeouts</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consecutive_timeouts</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Too many consecutive timeouts!&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_consecutive_timeouts</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_consecutive_timeouts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Update failed!&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">alarm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alarms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">alarm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">AlarmStatus</span><span class="o">.</span><span class="n">COMM</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">AlarmSeverity</span><span class="o">.</span><span class="n">MAJOR_ALARM</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interact-with-threaded-non-async-code-functions-and-libraries">
<h3>… interact with threaded/non-async code, functions, and libraries?<a class="headerlink" href="#interact-with-threaded-non-async-code-functions-and-libraries" title="Permalink to this heading">¶</a></h3>
<p>Defer it to an executor:
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor">here</a>.</p>
</section>
<section id="get-rid-of-pvgroup-and-pvproperty-i-hate-them">
<h3>… get rid of PVGroup and pvproperty? I hate them!<a class="headerlink" href="#get-rid-of-pvgroup-and-pvproperty-i-hate-them" title="Permalink to this heading">¶</a></h3>
<p>Those are some strong words!</p>
<p>caproto developers think the ease of customization and terseness of the class
definition are positives - making it the easiest possible way to spin up an IOC
- but we respect that it’s not a one-size-fits-all approach.</p>
<p>Let’s rephrase the above as “How do I use the alternative methods of building
IOCs?”</p>
<p>The first option is to try working with <code class="docutils literal notranslate"><span class="pre">PVSpec</span></code> instances directly.
Take a look at the <code class="docutils literal notranslate"><span class="pre">no_pvproperty</span></code> example.</p>
<p>The second option is going down to the lowest level, working with
<code class="docutils literal notranslate"><span class="pre">ChannelData</span></code> instances directly. Take a look at the advanced
<code class="docutils literal notranslate"><span class="pre">type_varieties</span></code> example.</p>
</section>
<section id="represent-both-the-setpoint-and-readback-with-one-pvproperty">
<h3>… represent both the setpoint and readback with one pvproperty?<a class="headerlink" href="#represent-both-the-setpoint-and-readback-with-one-pvproperty" title="Permalink to this heading">¶</a></h3>
<p>EPICS V3 records mostly do not have support for this, and caproto does not try
to improve upon the status quo.</p>
<p>A common convention – areaDetector-style – where there are 2 PVs, one
for the setpoint and one for the readback looks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SYSTEM</span><span class="p">:</span><span class="n">Value</span>
<span class="n">SYSTEM</span><span class="p">:</span><span class="n">Value_RBV</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">SYSTEM:Value</span></code> is the setpoint, and <code class="docutils literal notranslate"><span class="pre">SYSTEM:Value_RBV</span></code> is the
“read-back value” that updates only after the server (or device) has
acknowledged it.</p>
<p>caproto provides a simple helper tool to replicate this pattern efficiently.
Using <a class="reference internal" href="generated/caproto.server.get_pv_pair_wrapper.html#caproto.server.get_pv_pair_wrapper" title="caproto.server.get_pv_pair_wrapper"><code class="xref py py-func docutils literal notranslate"><span class="pre">server.get_pv_pair_wrapper()</span></code></a>, one can dynamically generate a
<code class="docutils literal notranslate"><span class="pre">SubGroup</span></code> that contains both the setpoint and readback PVs.  This wrapper is
re-usable and may be used to generate any number of such pairs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pvproperty_with_rbv</span> <span class="o">=</span> <span class="n">get_pv_pair_wrapper</span><span class="p">(</span><span class="n">setpoint_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                          <span class="n">readback_suffix</span><span class="o">=</span><span class="s1">&#39;_RBV&#39;</span><span class="p">)</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">pvproperty_with_rbv</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;This is a new subgroup with Value and Value_RBV.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@value</span><span class="o">.</span><span class="n">setpoint</span><span class="o">.</span><span class="n">putter</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># accept the value immediately</span>
    <span class="k">await</span> <span class="n">obj</span><span class="o">.</span><span class="n">readback</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="c1"># NOTE: you can access the full Group instance through obj.parent</span>
</pre></div>
</div>
<p>You can further customize the setpoint and readback keyword arguments
by using <code class="docutils literal notranslate"><span class="pre">setpoint_kw</span></code> and <code class="docutils literal notranslate"><span class="pre">readback_kw</span></code>. For example, you can
set different record types by specifying <code class="docutils literal notranslate"><span class="pre">setpoint_kw=dict(record=&quot;ao&quot;)</span></code>.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.get_pv_pair_wrapper.html#caproto.server.get_pv_pair_wrapper" title="caproto.server.get_pv_pair_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.server.get_pv_pair_wrapper</span></code></a>([...])</p></td>
<td><p>Generates a Subgroup class for a pair of PVs (setpoint and readback).</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The API of this changed in v0.7.0, making it easier to pass in class
kwargs.</p>
</div>
</section>
<section id="do-some-really-crazy-things-with-caproto">
<h3>… do some really crazy things with caproto?<a class="headerlink" href="#do-some-really-crazy-things-with-caproto" title="Permalink to this heading">¶</a></h3>
<p>Take a look at the pathological IOC examples.  Take extra care not to run them
in production!</p>
</section>
<section id="handle-records-and-what-are-the-limitations-there">
<h3>… handle records and what are the limitations there?<a class="headerlink" href="#handle-records-and-what-are-the-limitations-there" title="Permalink to this heading">¶</a></h3>
<p>For any given pvproperty, you can specify a caproto-supported record type by
way of the <code class="docutils literal notranslate"><span class="pre">record=''</span></code> keyword argument.</p>
<p>Please note that none of the classes listed here implement the full
functionality of the corresponding record, but make available over Channel
Access all of the fields one would normally expect from that record.</p>
<p>That said, some functionality is provided out-of-the-box, and you can further
customize this functionality in your own implementations.</p>
<p>See the <a class="reference internal" href="records.html"><span class="doc">Records</span></a> section for further details.</p>
<p>Further limitations/notes:</p>
<ul class="simple">
<li><p>In/out links do not work</p></li>
<li><p>Many fields are not (yet) implemented</p></li>
</ul>
</section>
<section id="add-a-client-to-monitor-other-pvs">
<h3>… add a client to monitor other PVs?<a class="headerlink" href="#add-a-client-to-monitor-other-pvs" title="Permalink to this heading">¶</a></h3>
<p>As of the time of writing, the threading client is more well-tested than the
asyncio client, and an example <code class="xref py py-mod docutils literal notranslate"><span class="pre">thread_client_monitor</span></code> was written
around it.</p>
<p>The above is admittedly rather complicated, but gives you a good amount of
control. It also demonstrates thread-to-async communication by way of
async library-independent queues.</p>
<p>A more user-friendly (but less tested) example is
<code class="xref py py-mod docutils literal notranslate"><span class="pre">ioc_examples.client_monitor_async</span></code>, which is currently limited to
asyncio-only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">import</span> <span class="nn">caproto</span> <span class="k">as</span> <span class="nn">ca</span>
<span class="kn">from</span> <span class="nn">caproto.asyncio.client</span> <span class="kn">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">MirrorClientIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IOC which mirrors the value, timestamp, and alarm status of a given PV</span>
<span class="sd">    into the `mirrored` pvproperty.</span>

<span class="sd">    With the default configuration, this IOC assumes that the PV &quot;simple:A&quot;</span>
<span class="sd">    exists on some external IOC.</span>

<span class="sd">    The &quot;simple&quot; IOC may be started before or after this IOC.  If the server</span>
<span class="sd">    goes down, the client will automatically reconnect when available.</span>

<span class="sd">    Scalar PVs</span>
<span class="sd">    ----------</span>
<span class="sd">    mirrored (float, analog input)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mirrored</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_to_mirror</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_to_mirror</span> <span class="o">=</span> <span class="n">pv_to_mirror</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__ainit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* `__ainit__` startup hook called&#39;</span><span class="p">)</span>

        <span class="c1"># Create an asyncio client context:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>

        <span class="c1"># Loop and grab items from the queue one at a time</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ctx</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pv_to_mirror</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;subscription&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Client pushed a new value in the queue&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Value=</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># Mirror the value, status, severity, and timestamp:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                          <span class="n">timestamp</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                                          <span class="n">status</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                          <span class="n">severity</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">severity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;connection&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;* Client connection state changed: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;disconnected&#39;</span><span class="p">:</span>
                    <span class="c1"># Raise an alarm - our client PV is disconnected.</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">ca</span><span class="o">.</span><span class="n">AlarmStatus</span><span class="o">.</span><span class="n">LINK</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="n">ca</span><span class="o">.</span><span class="n">AlarmSeverity</span><span class="o">.</span><span class="n">MAJOR_ALARM</span>
                    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;mirror:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="n">MirrorClientIOC</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">),</span>
        <span class="n">supported_async_libs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MirrorClientIOC</span><span class="p">(</span><span class="s1">&#39;simple:A&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="n">startup_hook</span><span class="o">=</span><span class="n">ioc</span><span class="o">.</span><span class="n">__ainit__</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.client_monitor_async.MirrorClientIOC.html#caproto.ioc_examples.client_monitor_async.MirrorClientIOC" title="caproto.ioc_examples.client_monitor_async.MirrorClientIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.client_monitor_async.MirrorClientIOC</span></code></a>(...)</p></td>
<td><p>An IOC which mirrors the value, timestamp, and alarm status of a given PV into the <cite>mirrored</cite> pvproperty.</p></td>
</tr>
</tbody>
</table>
<p>To work directly with the asyncio client context, you might consider basing
your IOC on the following example instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">caproto.asyncio.client</span> <span class="kn">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template_arg_parser</span>


<span class="k">class</span> <span class="nc">Mirror</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subscribe to a PV and serve its value.</span>

<span class="sd">    The default prefix is ``mirror:``.</span>

<span class="sd">    PVs</span>
<span class="sd">    ---</span>
<span class="sd">    value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO This assumes the type of the value is float.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>  <span class="c1"># PV to mirror</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_context</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="c1"># Update our own value based on the monitored one:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="c1"># We can even make the timestamp the same:</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">startup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="c1"># Note that the asyncio context must be created here so that it knows</span>
        <span class="c1"># which asyncio loop to use:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pv</span><span class="p">,</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_context</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># Subscribe to the target PV and register self._callback.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span><span class="p">,</span> <span class="n">split_args</span> <span class="o">=</span> <span class="n">template_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;mirror:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Mirror the value of another floating-point PV.&#39;</span><span class="p">,</span>
        <span class="n">supported_async_libs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;asyncio&#39;</span><span class="p">,)</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--target&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The PV to mirror&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">split_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">Mirror</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mirror.Mirror.html#caproto.ioc_examples.mirror.Mirror" title="caproto.ioc_examples.mirror.Mirror"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mirror.Mirror</span></code></a>(*args, ...)</p></td>
<td><p>Subscribe to a PV and serve its value.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="get-custom-arguments-into-my-ioc">
<h3>… get custom arguments into my IOC?<a class="headerlink" href="#get-custom-arguments-into-my-ioc" title="Permalink to this heading">¶</a></h3>
<p>At the moment, the easiest way to get a custom argument into an IOC is by
specifying a macro with a default value to
<a class="reference internal" href="generated/caproto.server.ioc_arg_parser.html#caproto.server.ioc_arg_parser" title="caproto.server.ioc_arg_parser"><code class="xref py py-func docutils literal notranslate"><span class="pre">caproto.server.ioc_arg_parser()</span></code></a>.</p>
<p>These macros would be accessible in your <code class="docutils literal notranslate"><span class="pre">PVGroup</span></code> <code class="docutils literal notranslate"><span class="pre">__init__</span></code> as the
<code class="docutils literal notranslate"><span class="pre">macros</span></code> keyword argument.</p>
<p>Alternatively, you can add arguments directly to the parser, as seen
in the <code class="docutils literal notranslate"><span class="pre">chirp</span></code> example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">,</span> <span class="n">split_args</span> <span class="o">=</span> <span class="n">template_arg_parser</span><span class="p">(</span>
    <span class="n">default_prefix</span><span class="o">=</span><span class="s2">&quot;prefix:&quot;</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;IOC description.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;--flag&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set an arbitrary flag.&quot;</span><span class="p">,</span>
    <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">split_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">ioc</span> <span class="o">=</span> <span class="n">MyPVGroup</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<p>If your needs are more advanced, feel free to reimplement the above functions.
So long as you can instantiate your PVGroup and pass its pvdb to <code class="docutils literal notranslate"><span class="pre">run()</span></code>,
caproto will not complain.</p>
</section>
<section id="use-macros-and-what-are-macros">
<h3>… use macros? And what are macros?<a class="headerlink" href="#use-macros-and-what-are-macros" title="Permalink to this heading">¶</a></h3>
<p>Macros allow you to specify portions of PV names at IOC initialization-time
instead of at PVGroup/pvproperty definition time.</p>
<p>Macros can be used in addition to - or in place of - the default PV prefix.</p>
<p>See the <a class="reference internal" href="generated/caproto.ioc_examples.macros.MacroifiedNames.html#caproto.ioc_examples.macros.MacroifiedNames" title="caproto.ioc_examples.macros.MacroifiedNames"><code class="xref py py-class docutils literal notranslate"><span class="pre">MacroifiedNames</span></code></a> for an example.</p>
</section>
<section id="make-a-bunch-of-caproto-iocs-without-all-the-boilerplate">
<h3>… make a bunch of caproto IOCs without all the boilerplate?<a class="headerlink" href="#make-a-bunch-of-caproto-iocs-without-all-the-boilerplate" title="Permalink to this heading">¶</a></h3>
<p>Take a look at the cookiecutters.  You can generate a full Python package IOC
template along with a startup script template pretty quickly with this tool.</p>
</section>
<section id="get-a-structured-view-of-my-pvgroup-on-the-client-side">
<h3>… get a structured view of my PVGroup on the client side?<a class="headerlink" href="#get-a-structured-view-of-my-pvgroup-on-the-client-side" title="Permalink to this heading">¶</a></h3>
<p>(This is a shameless plug for our other free tools…)</p>
<p>Consider trying <a class="reference external" href="https://blueskyproject.io/">ophyd</a>. devices as the
client-side interface to your server-side caproto IOC.</p>
<p>If you buy into this ecosystem, you will be able to:</p>
<ul class="simple">
<li><p>Use your caproto-backed PVs in scans and other data acquisition routines
by way of bluesky</p></li>
<li><p>Auto-generate EPICS user interfaces with Typhos and PyDM</p></li>
<li><p>Track and organize your devices by way of happi</p></li>
</ul>
</section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h2>
<p>Below, we will use caproto’s threading client to interact with caproto IOC.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">caproto.threading.client</span> <span class="kn">import</span> <span class="n">Context</span>

<span class="gp">In [2]: </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>  <span class="c1"># a client Context used to explore the servers below</span>
</pre></div>
</div>
<p>Of course, standard epics-base clients or other caproto clients may also be
used.</p>
<section id="simple-ioc">
<h3>Simple IOC<a class="headerlink" href="#simple-ioc" title="Permalink to this heading">¶</a></h3>
<p>This IOC has two PVs that simply store a value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">SimpleIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IOC with three uncoupled read/writable PVs.</span>

<span class="sd">    Scalar PVs</span>
<span class="sd">    ----------</span>
<span class="sd">    A (int)</span>
<span class="sd">    B (float)</span>

<span class="sd">    Array PVs</span>
<span class="sd">    ---------</span>
<span class="sd">    C (array of int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;An integer&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;A float&#39;</span>
    <span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;An array of integers (max length 3)&#39;</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;simple:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="n">SimpleIOC</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">SimpleIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.simple.SimpleIOC.html#caproto.ioc_examples.simple.SimpleIOC" title="caproto.ioc_examples.simple.SimpleIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.simple.SimpleIOC</span></code></a>(prefix, *)</p></td>
<td><p>An IOC with three uncoupled read/writable PVs.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.simple<span class="w"> </span>--list-pvs
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:08:47.628<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:08:47.630<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:56840
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:08:47.630<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:08:47.630<span class="w"> </span>server:123<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>simple:A
<span class="w">    </span>simple:B
<span class="w">    </span>simple:C
</pre></div>
</div>
<p>Using the threading client context we created above, we can read these values
and write to them.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;simple:A&#39;</span><span class="p">,</span> <span class="s1">&#39;simple:B&#39;</span><span class="p">,</span> <span class="s1">&#39;simple:C&#39;</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="n">a</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[4]: </span><span class="go">ReadNotifyResponse(data=array([1], dtype=int32), data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)</span>

<span class="gp">In [5]: </span><span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[5]: </span><span class="go">ReadNotifyResponse(data=array([2.]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=1, metadata=None)</span>

<span class="gp">In [6]: </span><span class="n">c</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[6]: </span><span class="go">ReadNotifyResponse(data=array([1, 2, 3], dtype=int32), data_type=&lt;ChannelType.LONG: 5&gt;, data_count=3, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=2, metadata=None)</span>

<span class="gp">In [7]: </span><span class="n">b</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gh">Out[7]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=3)</span>

<span class="gp">In [8]: </span><span class="n">b</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go">ReadNotifyResponse(data=array([5.]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=4, metadata=None)</span>

<span class="gp">In [9]: </span><span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="gh">Out[9]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.LONG: 5&gt;, data_count=3, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=5)</span>

<span class="gp">In [10]: </span><span class="n">c</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[10]: </span><span class="go">ReadNotifyResponse(data=array([4, 5, 6], dtype=int32), data_type=&lt;ChannelType.LONG: 5&gt;, data_count=3, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=6, metadata=None)</span>
</pre></div>
</div>
</section>
<section id="write-to-a-file-when-a-pv-is-written-to">
<h3>Write to a File When a PV is Written To<a class="headerlink" href="#write-to-a-file-when-a-pv-is-written-to" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">CustomWrite</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When a PV is written to, write the new value into a file as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">my_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Compose the filename based on whichever PV this is.</span>
        <span class="c1"># For this IOC, the following will be: &#39;A&#39; or &#39;B&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">directory</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The directory to write data to&quot;</span><span class="p">,</span>
        <span class="n">string_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
        <span class="n">report_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">my_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Writes to (DIRECTORY)/A&quot;</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">my_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Writes to (DIRECTORY)/B&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;custom_write:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">CustomWrite</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">CustomWrite</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.custom_write<span class="w"> </span>--list-pvs
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:12:07.282<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:12:07.284<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:57539
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:12:07.284<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:12:07.284<span class="w"> </span>server:123<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>custom_write:A
<span class="w">    </span>custom_write:B
</pre></div>
</div>
<p>On the machine where the server resides, we will see files update whenever any
client writes.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="kn">import</span> <span class="nn">pathlib</span>

<span class="gp">In [12]: </span><span class="kn">import</span> <span class="nn">tempfile</span>

<span class="go"># /tmp on Linux, %TEMP% on Windows, /var/folders on macOS, ...</span>
<span class="gp">In [13]: </span><span class="n">ioc_write_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">())</span> <span class="o">/</span> <span class="s1">&#39;A&#39;</span>

<span class="gp">In [14]: </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;custom_write:A&#39;</span><span class="p">,</span> <span class="s1">&#39;custom_write:B&#39;</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">a</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gh">Out[15]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0)</span>

<span class="gp">In [16]: </span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">ioc_write_path</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="go">5</span>


<span class="gp">In [17]: </span><span class="n">a</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gh">Out[17]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=1)</span>

<span class="gp">In [18]: </span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">ioc_write_path</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="go">10</span>
</pre></div>
</div>
<p>It is easy to imagine extending this example to write a socket or a serial
device rather than a file.</p>
</section>
<section id="random-walk">
<h3>Random Walk<a class="headerlink" href="#random-walk" title="Permalink to this heading">¶</a></h3>
<p>This example contains a PV <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> that takes random steps at an
update rate controlled by a second PV, <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.random_walk.RandomWalkIOC.html#caproto.ioc_examples.random_walk.RandomWalkIOC" title="caproto.ioc_examples.random_walk.RandomWalkIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.random_walk.RandomWalkIOC</span></code></a>(...)</p></td>
<td><p>This example contains a PV <code class="docutils literal notranslate"><span class="pre">x</span></code> that takes random steps at an update rate controlled by a second PV, <code class="docutils literal notranslate"><span class="pre">dt</span></code>.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">RandomWalkIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This example contains a PV ``x`` that takes random steps at an update rate</span>
<span class="sd">    controlled by a second PV, ``dt``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Delta time [sec]&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The random float value&quot;</span><span class="p">)</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">startup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is a startup hook which periodically updates the value.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Grab the current value from `self.x` and compute the next value:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span>

            <span class="c1"># Update the ChannelData instance and notify any subscribers:</span>
            <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Let the async library wait for the next iteration</span>
            <span class="k">await</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;random_walk:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="n">RandomWalkIOC</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">RandomWalkIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>What is async_lib.library.sleep?</strong></p>
<p>As caproto supports three different async libraries, we have an “async
layer” class that gives compatible async versions of commonly-used
synchronization primitives. The attribute <code class="docutils literal notranslate"><span class="pre">async_lib.library</span></code> would be either
the Python module <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> (default), <code class="docutils literal notranslate"><span class="pre">trio</span></code>, or <code class="docutils literal notranslate"><span class="pre">curio</span></code>, depending on how
the server is run.  It happens that all three of these modules have a <code class="docutils literal notranslate"><span class="pre">sleep</span></code>
function at the top level, so <code class="docutils literal notranslate"><span class="pre">async_lib.library.sleep</span></code> accesses the
appropriate sleep function for each library.</p>
<p><strong>Why not use time.sleep?</strong></p>
<p>The gist is that <code class="docutils literal notranslate"><span class="pre">asyncio.sleep</span></code> doesn’t hold up your entire thread /
event loop, but gives back control to the event loop to run other tasks while
sleeping. The function <code class="docutils literal notranslate"><span class="pre">time.sleep</span></code>, on the other hand, would cause
noticeable delays and problems.</p>
<p>This is a fundamental consideration in concurrent programming generally,
not specific to caproto. See for example
<a class="reference external" href="https://stackoverflow.com/questions/46207991/what-does-yield-from-asyncio-sleepdelay-do">this StackOverflow post</a>
for more information.</p>
</div>
</section>
<section id="i-o-interrupt">
<h3>I/O Interrupt<a class="headerlink" href="#i-o-interrupt" title="Permalink to this heading">¶</a></h3>
<p>This example listens for key presses.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor.html#caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor" title="caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.io_interrupt.start_io_interrupt_monitor</span></code></a>(...)</p></td>
<td><p>This function monitors the terminal it was run in for keystrokes.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.io_interrupt.IOInterruptIOC.html#caproto.ioc_examples.io_interrupt.IOInterruptIOC" title="caproto.ioc_examples.io_interrupt.IOInterruptIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.io_interrupt.IOInterruptIOC</span></code></a>(...)</p></td>
<td><p>An IOC that updates on keypress events.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">termios</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">def</span> <span class="nf">start_io_interrupt_monitor</span><span class="p">(</span><span class="n">new_value_callback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function monitors the terminal it was run in for keystrokes.</span>
<span class="sd">    On each keystroke, it calls new_value_callback with the given keystroke.</span>

<span class="sd">    This is used to simulate the concept of an I/O Interrupt-style signal from</span>
<span class="sd">    the EPICS world. Those signals depend on hardware to tell EPICS when new</span>
<span class="sd">    values are available to be read by way of interrupts - whereas we use</span>
<span class="sd">    callbacks here.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Thanks stackoverflow and Python 2 FAQ!</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdin__</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[IO Interrupt] stdin is not a TTY, exiting&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>

    <span class="n">oldterm</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">newattr</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">newattr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">termios</span><span class="o">.</span><span class="n">ICANON</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">termios</span><span class="o">.</span><span class="n">ECHO</span>
    <span class="n">oldflags</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_GETFL</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Started monitoring the keyboard outside of the async library&#39;</span><span class="p">)</span>

    <span class="c1"># When the process exits, be sure to reset the terminal settings</span>
    <span class="nd">@atexit</span><span class="o">.</span><span class="n">register</span>
    <span class="k">def</span> <span class="nf">reset_terminal</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resetting the terminal settings&#39;</span><span class="p">)</span>
        <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSAFLUSH</span><span class="p">,</span> <span class="n">oldterm</span><span class="p">)</span>
        <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">oldflags</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>

    <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSANOW</span><span class="p">,</span> <span class="n">newattr</span><span class="p">)</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">oldflags</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_NONBLOCK</span><span class="p">)</span>

    <span class="c1"># Loop forever, sending back keypresses to the callback</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New keypress: </span><span class="si">{</span><span class="n">char</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">new_value_callback</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IOInterruptIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IOC that updates on keypress events.</span>

<span class="sd">    PVs</span>
<span class="sd">    ---</span>
<span class="sd">    keypress (str)</span>
<span class="sd">        The latest key pressed in the IOC terminal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keypress</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Latest keypress&quot;</span><span class="p">,</span>
        <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># NOTE the decorator used here:</span>
    <span class="nd">@keypress</span><span class="o">.</span><span class="n">startup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">keypress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="c1"># This method will be called when the server starts up.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* keypress method called at server startup&#39;</span><span class="p">)</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">ThreadsafeQueue</span><span class="p">()</span>

        <span class="c1"># Start a separate thread that monitors keyboard input, telling it to</span>
        <span class="c1"># put new values into our async-friendly queue</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">start_io_interrupt_monitor</span><span class="p">,</span>
            <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">new_value_callback</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Loop and grab items from the queue one at a time</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">async_get</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saw new value on async side: </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Propagate the keypress to the EPICS PV, triggering any monitors</span>
            <span class="c1"># along the way</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">keypress</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;io:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">IOInterruptIOC</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">ioc</span> <span class="o">=</span> <span class="n">IOInterruptIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.io_interrupt<span class="w"> </span>--list-pvs
<span class="o">[</span>I<span class="w"> </span><span class="m">10</span>:18:57.643<span class="w"> </span>server:132<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">10</span>:18:57.644<span class="w"> </span>server:145<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:54583
<span class="o">[</span>I<span class="w"> </span><span class="m">10</span>:18:57.646<span class="w"> </span>server:218<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">10</span>:18:57.646<span class="w"> </span>server:220<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>io:keypress
*<span class="w"> </span>keypress<span class="w"> </span>method<span class="w"> </span>called<span class="w"> </span>at<span class="w"> </span>server<span class="w"> </span>startup
Started<span class="w"> </span>monitoring<span class="w"> </span>the<span class="w"> </span>keyboard<span class="w"> </span>outside<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>async<span class="w"> </span>library
</pre></div>
</div>
<p>Typing causes updates to be sent to any client subscribed to <code class="docutils literal notranslate"><span class="pre">io:keypress</span></code>.
If we monitoring using the commandline-client like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>caproto-monitor<span class="w"> </span>io:keypress
</pre></div>
</div>
<p>and go back to the server and type some keys:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>New<span class="w"> </span>keypress:<span class="w"> </span><span class="s1">&#39;a&#39;</span>
Saw<span class="w"> </span>new<span class="w"> </span>value<span class="w"> </span>on<span class="w"> </span>async<span class="w"> </span>side:<span class="w"> </span><span class="s1">&#39;a&#39;</span>
New<span class="w"> </span>keypress:<span class="w"> </span><span class="s1">&#39;b&#39;</span>
Saw<span class="w"> </span>new<span class="w"> </span>value<span class="w"> </span>on<span class="w"> </span>async<span class="w"> </span>side:<span class="w"> </span><span class="s1">&#39;b&#39;</span>
New<span class="w"> </span>keypress:<span class="w"> </span><span class="s1">&#39;c&#39;</span>
Saw<span class="w"> </span>new<span class="w"> </span>value<span class="w"> </span>on<span class="w"> </span>async<span class="w"> </span>side:<span class="w"> </span><span class="s1">&#39;c&#39;</span>
New<span class="w"> </span>keypress:<span class="w"> </span><span class="s1">&#39;d&#39;</span>
Saw<span class="w"> </span>new<span class="w"> </span>value<span class="w"> </span>on<span class="w"> </span>async<span class="w"> </span>side:<span class="w"> </span><span class="s1">&#39;d&#39;</span>
</pre></div>
</div>
<p>the client will receive the updates:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>io:keypress<span class="w">                               </span><span class="m">2018</span>-06-14<span class="w"> </span><span class="m">10</span>:19:04<span class="w"> </span><span class="o">[</span>b<span class="s1">&#39;d&#39;</span><span class="o">]</span>
io:keypress<span class="w">                               </span><span class="m">2018</span>-06-14<span class="w"> </span><span class="m">10</span>:20:26<span class="w"> </span><span class="o">[</span>b<span class="s1">&#39;a&#39;</span><span class="o">]</span>
io:keypress<span class="w">                               </span><span class="m">2018</span>-06-14<span class="w"> </span><span class="m">10</span>:20:26<span class="w"> </span><span class="o">[</span>b<span class="s1">&#39;s&#39;</span><span class="o">]</span>
io:keypress<span class="w">                               </span><span class="m">2018</span>-06-14<span class="w"> </span><span class="m">10</span>:20:26<span class="w"> </span><span class="o">[</span>b<span class="s1">&#39;d&#39;</span><span class="o">]</span>
</pre></div>
</div>
</section>
<section id="macros-for-pv-names">
<h3>Macros for PV names<a class="headerlink" href="#macros-for-pv-names" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.macros.MacroifiedNames.html#caproto.ioc_examples.macros.MacroifiedNames" title="caproto.ioc_examples.macros.MacroifiedNames"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.macros.MacroifiedNames</span></code></a>(...)</p></td>
<td><p>An IOC with PVs that have macro-ified names.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">MacroifiedNames</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IOC with PVs that have macro-ified names.</span>

<span class="sd">    Required macros: &quot;beamline&quot; and &quot;suffix&quot;</span>

<span class="sd">    PVs</span>
<span class="sd">    ---</span>
<span class="sd">    {beamline}:{suffix}.VAL</span>
<span class="sd">    {beamline}:{suffix}.RBV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">placeholder1</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{beamline}</span><span class="s1">:</span><span class="si">{suffix}</span><span class="s1">.VAL&#39;</span><span class="p">)</span>
    <span class="n">placeholder2</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{beamline}</span><span class="s1">:</span><span class="si">{suffix}</span><span class="s1">.RBV&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;macros:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="n">MacroifiedNames</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">),</span>
        <span class="c1"># Provide default values for macros.</span>
        <span class="c1"># Passing None as a default value makes a parameter required.</span>
        <span class="n">macros</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">beamline</span><span class="o">=</span><span class="s1">&#39;my_beamline&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;thing&#39;</span><span class="p">))</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MacroifiedNames</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<p>The help string for this IOC contains two extra entries at the bottom:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.macros<span class="w"> </span>-h
usage:<span class="w"> </span>macros.py<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--prefix<span class="w"> </span>PREFIX<span class="o">]</span><span class="w"> </span><span class="o">[</span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>-v<span class="o">]</span><span class="w"> </span><span class="o">[</span>--list-pvs<span class="o">]</span>
<span class="w">                </span><span class="o">[</span>--async-lib<span class="w"> </span><span class="o">{</span>asyncio,curio,trio<span class="o">}]</span>
<span class="w">                </span><span class="o">[</span>--interfaces<span class="w"> </span>INTERFACES<span class="w"> </span><span class="o">[</span>INTERFACES<span class="w"> </span>...<span class="o">]]</span>
<span class="w">                </span><span class="o">[</span>--beamline<span class="w"> </span>BEAMLINE<span class="o">]</span><span class="w"> </span><span class="o">[</span>--suffix<span class="w"> </span>SUFFIX<span class="o">]</span>

Run<span class="w"> </span>an<span class="w"> </span>IOC<span class="w"> </span>with<span class="w"> </span>PVs<span class="w"> </span>that<span class="w"> </span>have<span class="w"> </span>macro-ified<span class="w"> </span>names.

optional<span class="w"> </span>arguments:

&lt;...snipped...&gt;

--beamline<span class="w"> </span>BEAMLINE<span class="w">   </span>Macro<span class="w"> </span>substitution,<span class="w"> </span>optional
--suffix<span class="w"> </span>SUFFIX<span class="w">       </span>Macro<span class="w"> </span>substitution,<span class="w"> </span>optional
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.macros<span class="w"> </span>--beamline<span class="w"> </span>XF31ID<span class="w"> </span>--suffix<span class="w"> </span>detector<span class="w"> </span>--list-pvs
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:44:39.528<span class="w"> </span>server:93<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:44:39.530<span class="w"> </span>server:109<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:56365
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:44:39.531<span class="w"> </span>server:121<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">18</span>:44:39.531<span class="w"> </span>server:123<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>macros:XF31ID:detector.VAL
<span class="w">    </span>macros:XF31ID:detector.RBV
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">pv</span><span class="p">,</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;macros:XF31ID:detector.VAL&#39;</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[20]: </span><span class="go">ReadNotifyResponse(data=array([0], dtype=int32), data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)</span>
</pre></div>
</div>
<p>Observe that the command line arguments fill in the PV names.</p>
</section>
<section id="subgroups">
<h3>Subgroups<a class="headerlink" href="#subgroups" title="Permalink to this heading">¶</a></h3>
<p>The PVGroup is designed to be nested, which provides a nice path toward future
capability: IOCs that are natively “V7”, encoding semantic structure for PV
Access clients and decomposing into flat PVs for Channel Access clients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">SubGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">MySubGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example group of PVs, where the prefix is defined on instantiation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>

    <span class="n">rand</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;A random value between 1 and self.max_value.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@rand</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">stop_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_scan_field</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">rand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">pvname</span><span class="si">}</span><span class="s1"> a random value in [1, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s1">&#39;Example group of PVs, a mix of pvproperties and subgroups&#39;</span>

    <span class="c1"># Create two subgroups:</span>
    <span class="n">group1</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">MySubGroup</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;group1:&quot;</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">group2</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">MySubGroup</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;group2:&#39;</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># And a third one, using the decorator pattern:</span>
    <span class="nd">@SubGroup</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;group3:&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">group3</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
        <span class="n">nested_rand</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;A random value between 1 and self.max_value.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nd">@nested_rand</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">stop_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_scan_field</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">nested_rand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">pvname</span><span class="si">}</span><span class="s1"> random value from 1 to </span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;subgroups:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with groups of groups of PVs.&#39;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MyPVGroup</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.subgroups<span class="w"> </span>--list-pvs
random<span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span>descriptor<span class="w"> </span>getter<span class="w"> </span>is:<span class="w"> </span>&lt;caproto.server.server.PvpropertyInteger<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x10928ffd0&gt;
subgroup4<span class="w"> </span>is:<span class="w"> </span>&lt;__main__.MyPVGroup.group4.subgroup4<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x10928fe10&gt;
subgroup4.random<span class="w"> </span>is:<span class="w"> </span>&lt;caproto.server.server.PvpropertyInteger<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x10928fef0&gt;
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:08:35.074<span class="w"> </span>server:132<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:08:35.074<span class="w"> </span>server:145<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:63336
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:08:35.076<span class="w"> </span>server:218<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:08:35.077<span class="w"> </span>server:220<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>subgroups:random
<span class="w">    </span>subgroups:RECORD_LIKE1.RTYP
<span class="w">    </span>subgroups:RECORD_LIKE1.VAL
<span class="w">    </span>subgroups:RECORD_LIKE1.DESC
<span class="w">    </span>subgroups:recordlike2.RTYP
<span class="w">    </span>subgroups:recordlike2.VAL
<span class="w">    </span>subgroups:recordlike2.DESC
<span class="w">    </span>subgroups:group1:random
<span class="w">    </span>subgroups:group2-random
<span class="w">    </span>subgroups:group3_prefix:random
<span class="w">    </span>subgroups:group4:subgroup4:random
</pre></div>
</div>
</section>
<section id="records">
<span id="records-example"></span><h3>Records<a class="headerlink" href="#records" title="Permalink to this heading">¶</a></h3>
<p>See <a class="reference internal" href="records.html"><span class="doc">Records</span></a>.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.records.RecordMockingIOC.html#caproto.ioc_examples.records.RecordMockingIOC" title="caproto.ioc_examples.records.RecordMockingIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.records.RecordMockingIOC</span></code></a>(...)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PVGroup</span><span class="p">,</span> <span class="n">PvpropertyDouble</span><span class="p">,</span> <span class="n">PvpropertyInteger</span><span class="p">,</span>
                            <span class="n">PvpropertyString</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">caproto.server.records</span> <span class="kn">import</span> <span class="n">AiFields</span><span class="p">,</span> <span class="n">AoFields</span>


<span class="k">class</span> <span class="nc">RecordMockingIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="c1"># Define three records, an analog input (ai) record:</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">PvpropertyDouble</span><span class="p">[</span><span class="n">AiFields</span><span class="p">],</span> <span class="n">record</span><span class="o">=</span><span class="n">AiFields</span><span class="p">)</span>
    <span class="c1"># And an analog output (ao) record:</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">PvpropertyDouble</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">AoFields</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># and an ai with all the bells and whistles</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">record</span><span class="o">=</span><span class="s2">&quot;ai&quot;</span><span class="p">,</span>
        <span class="n">upper_alarm_limit</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">lower_alarm_limit</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">upper_warning_limit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">lower_warning_limit</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">upper_ctrl_limit</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
        <span class="n">lower_ctrl_limit</span><span class="o">=-</span><span class="mf">3.0</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>
        <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The C pvproperty&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># In the above, you&#39;ll note that we still support referencing records by</span>
    <span class="c1"># their (string) name.  we recommend that you use the field classes (e.g.,</span>
    <span class="c1"># AiFields) to be more explicit and allow your static analyzer to help</span>
    <span class="c1"># check your code.</span>

    <span class="nd">@B</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_b_val_put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">PvpropertyDouble</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Mocked record will pick up the alarm status simply by us raising</span>
            <span class="c1"># an exception in the putter:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid value!&#39;</span><span class="p">)</span>

    <span class="c1"># It&#39;s also possible to modify some of the behavior of fields on a per-</span>
    <span class="c1"># record basis. The following function is called whenever A.RVAL is put to:</span>
    <span class="nd">@A</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">current_raw_value</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_a_raw_put</span><span class="p">(</span><span class="n">fields</span><span class="p">:</span> <span class="n">AiFields</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">PvpropertyInteger</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># However, somewhat confusingly, &#39;self&#39; in this case is the fields</span>
        <span class="c1"># associated with &#39;A&#39;. To access the IOC (i.e., the main PV group)</span>
        <span class="c1"># use the following:</span>
        <span class="n">ioc</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">group</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A.RVAL: Writing values to A and B: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@B</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">current_raw_value</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">_b_raw_put</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">PvpropertyInteger</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ioc</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">group</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.RVAL: Writing modified values to A, B&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Now that the field specification has been set on B, it can be reused:</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">field_spec</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">field_spec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">PvpropertyDouble</span>
    <span class="p">)</span>
    <span class="c1"># D will also be reported as an &#39;ao&#39; record like B, as it uses the same</span>
    <span class="c1"># field specification.</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;this is a test&quot;</span><span class="p">,</span>
        <span class="n">record</span><span class="o">=</span><span class="s2">&quot;stringin&quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">PvpropertyString</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;mock:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC that mocks an ai (analog input) record.&#39;</span><span class="p">)</span>

    <span class="c1"># Instantiate the IOC, assigning a prefix for the PV names.</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">RecordMockingIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PVs:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">))</span>

    <span class="c1"># ... but what you don&#39;t see are all of the analog input record fields</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fields of B:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of A:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of B:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of C:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of D:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of E:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

    <span class="c1"># Run IOC.</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>caproto.ioc_examples.records<span class="w"> </span>--list-pvs
PVs:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;mock:A&#39;</span>,<span class="w"> </span><span class="s1">&#39;mock:B&#39;</span><span class="o">]</span>
Fields<span class="w"> </span>of<span class="w"> </span>B:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;ACKS&#39;</span>,<span class="w"> </span><span class="s1">&#39;ACKT&#39;</span>,<span class="w"> </span><span class="s1">&#39;ASG&#39;</span>,<span class="w"> </span><span class="s1">&#39;DESC&#39;</span>,<span class="w"> </span><span class="s1">&#39;DISA&#39;</span>,<span class="w"> </span><span class="s1">&#39;DISP&#39;</span>,<span class="w"> </span><span class="s1">&#39;DISS&#39;</span>,<span class="w"> </span><span class="s1">&#39;DISV&#39;</span>,<span class="w"> </span><span class="s1">&#39;DTYP&#39;</span>,<span class="w"> </span><span class="s1">&#39;EVNT&#39;</span>,<span class="w"> </span><span class="s1">&#39;FLNK&#39;</span>,<span class="w"> </span><span class="s1">&#39;LCNT&#39;</span>,<span class="w"> </span><span class="s1">&#39;NAME&#39;</span>,<span class="w"> </span><span class="s1">&#39;NSEV&#39;</span>,<span class="w"> </span><span class="s1">&#39;NSTA&#39;</span>,<span class="w"> </span><span class="s1">&#39;PACT&#39;</span>,<span class="w"> </span><span class="s1">&#39;PHAS&#39;</span>,<span class="w"> </span><span class="s1">&#39;PINI&#39;</span>,<span class="w"> </span><span class="s1">&#39;PRIO&#39;</span>,<span class="w"> </span><span class="s1">&#39;PROC&#39;</span>,<span class="w"> </span><span class="s1">&#39;PUTF&#39;</span>,<span class="w"> </span><span class="s1">&#39;RPRO&#39;</span>,<span class="w"> </span><span class="s1">&#39;SCAN&#39;</span>,<span class="w"> </span><span class="s1">&#39;SDIS&#39;</span>,<span class="w"> </span><span class="s1">&#39;SEVR&#39;</span>,<span class="w"> </span><span class="s1">&#39;TPRO&#39;</span>,<span class="w"> </span><span class="s1">&#39;TSE&#39;</span>,<span class="w"> </span><span class="s1">&#39;TSEL&#39;</span>,<span class="w"> </span><span class="s1">&#39;UDF&#39;</span>,<span class="w"> </span><span class="s1">&#39;RTYP&#39;</span>,<span class="w"> </span><span class="s1">&#39;STAT&#39;</span>,<span class="w"> </span><span class="s1">&#39;RVAL&#39;</span>,<span class="w"> </span><span class="s1">&#39;INIT&#39;</span>,<span class="w"> </span><span class="s1">&#39;MLST&#39;</span>,<span class="w"> </span><span class="s1">&#39;LALM&#39;</span>,<span class="w"> </span><span class="s1">&#39;ALST&#39;</span>,<span class="w"> </span><span class="s1">&#39;LBRK&#39;</span>,<span class="w"> </span><span class="s1">&#39;ORAW&#39;</span>,<span class="w"> </span><span class="s1">&#39;ROFF&#39;</span>,<span class="w"> </span><span class="s1">&#39;SIMM&#39;</span>,<span class="w"> </span><span class="s1">&#39;SVAL&#39;</span>,<span class="w"> </span><span class="s1">&#39;HYST&#39;</span>,<span class="w"> </span><span class="s1">&#39;HIGH&#39;</span>,<span class="w"> </span><span class="s1">&#39;HSV&#39;</span>,<span class="w"> </span><span class="s1">&#39;HIHI&#39;</span>,<span class="w"> </span><span class="s1">&#39;HHSV&#39;</span>,<span class="w"> </span><span class="s1">&#39;LOLO&#39;</span>,<span class="w"> </span><span class="s1">&#39;LLSV&#39;</span>,<span class="w"> </span><span class="s1">&#39;LOW&#39;</span>,<span class="w"> </span><span class="s1">&#39;LSV&#39;</span>,<span class="w"> </span><span class="s1">&#39;AOFF&#39;</span>,<span class="w"> </span><span class="s1">&#39;ASLO&#39;</span>,<span class="w"> </span><span class="s1">&#39;EGUF&#39;</span>,<span class="w"> </span><span class="s1">&#39;EGUL&#39;</span>,<span class="w"> </span><span class="s1">&#39;LINR&#39;</span>,<span class="w"> </span><span class="s1">&#39;EOFF&#39;</span>,<span class="w"> </span><span class="s1">&#39;ESLO&#39;</span>,<span class="w"> </span><span class="s1">&#39;SMOO&#39;</span>,<span class="w"> </span><span class="s1">&#39;ADEL&#39;</span>,<span class="w"> </span><span class="s1">&#39;PREC&#39;</span>,<span class="w"> </span><span class="s1">&#39;EGU&#39;</span>,<span class="w"> </span><span class="s1">&#39;HOPR&#39;</span>,<span class="w"> </span><span class="s1">&#39;LOPR&#39;</span>,<span class="w"> </span><span class="s1">&#39;MDEL&#39;</span>,<span class="w"> </span><span class="s1">&#39;INP&#39;</span>,<span class="w"> </span><span class="s1">&#39;SIOL&#39;</span>,<span class="w"> </span><span class="s1">&#39;SIML&#39;</span>,<span class="w"> </span><span class="s1">&#39;SIMS&#39;</span><span class="o">]</span>
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:07:48.635<span class="w"> </span>server:132<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>starting<span class="w"> </span>up...
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:07:48.636<span class="w"> </span>server:145<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:49637
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:07:48.638<span class="w"> </span>server:218<span class="o">]</span><span class="w"> </span>Server<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="o">[</span>I<span class="w"> </span><span class="m">11</span>:07:48.638<span class="w"> </span>server:220<span class="o">]</span><span class="w"> </span>PVs<span class="w"> </span>available:
<span class="w">    </span>mock:A
<span class="w">    </span>mock:B
</pre></div>
</div>
</section>
<section id="mini-beamline">
<h3>Mini-Beamline<a class="headerlink" href="#mini-beamline" title="Permalink to this heading">¶</a></h3>
<p>Simulate your own mini beamline with this IOC.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.html#module-caproto.ioc_examples.mini_beamline" title="caproto.ioc_examples.mini_beamline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline</span></code></a></p></td>
<td><p>This example is quite large.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.MiniBeamline.html#caproto.ioc_examples.mini_beamline.MiniBeamline" title="caproto.ioc_examples.mini_beamline.MiniBeamline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline.MiniBeamline</span></code></a>(...)</p></td>
<td><p>A collection of detectors coupled to motors and an oscillating beam current.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.PinHole.html#caproto.ioc_examples.mini_beamline.PinHole" title="caproto.ioc_examples.mini_beamline.PinHole"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline.PinHole</span></code></a>(...)</p></td>
<td><p>A pinhole simulation device.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.Edge.html#caproto.ioc_examples.mini_beamline.Edge" title="caproto.ioc_examples.mini_beamline.Edge"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline.Edge</span></code></a>(...)</p></td>
<td><p>An edge simulation device.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.Slit.html#caproto.ioc_examples.mini_beamline.Slit" title="caproto.ioc_examples.mini_beamline.Slit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline.Slit</span></code></a>(...)</p></td>
<td><p>A slit simulation device.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.mini_beamline.MovingDot.html#caproto.ioc_examples.mini_beamline.MovingDot" title="caproto.ioc_examples.mini_beamline.MovingDot"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.mini_beamline.MovingDot</span></code></a>(...)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="more">
<h3>More…<a class="headerlink" href="#more" title="Permalink to this heading">¶</a></h3>
<p>Take a look around
<a class="reference external" href="https://github.com/caproto/caproto/tree/master/caproto/ioc_examples">the ioc_examples subpackage</a> for more examples not covered here.</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.enums.EnumIOC.html#caproto.ioc_examples.enums.EnumIOC" title="caproto.ioc_examples.enums.EnumIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.enums.EnumIOC</span></code></a>(prefix, *)</p></td>
<td><p>An IOC with some enums.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.autosave.AutosavedSimpleIOC.html#caproto.ioc_examples.autosave.AutosavedSimpleIOC" title="caproto.ioc_examples.autosave.AutosavedSimpleIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.autosave.AutosavedSimpleIOC</span></code></a>(...)</p></td>
<td><p>An IOC with three uncoupled read/writable PVs</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.decay.Decay.html#caproto.ioc_examples.decay.Decay" title="caproto.ioc_examples.decay.Decay"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.decay.Decay</span></code></a>(*args, **kwargs)</p></td>
<td><p>Simulates an exponential decay to a set point.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.ioc_examples.scan_rate.ScanRateIOC.html#caproto.ioc_examples.scan_rate.ScanRateIOC" title="caproto.ioc_examples.scan_rate.ScanRateIOC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">caproto.ioc_examples.scan_rate.ScanRateIOC</span></code></a>(...)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="Permalink to this heading">¶</a></h2>
<p>caproto offers several “helper” subgroups (<a class="reference internal" href="generated/caproto.server.SubGroup.html#caproto.server.SubGroup" title="caproto.server.SubGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubGroup</span></code></a>)
that are of general use, and could be considered part of the “caproto server
standard library”, so to speak.</p>
<section id="autosave">
<h3>Autosave<a class="headerlink" href="#autosave" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.autosave.AutosaveHelper.html#caproto.server.autosave.AutosaveHelper" title="caproto.server.autosave.AutosaveHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AutosaveHelper</span></code></a>(*args[, file_manager])</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.server.autosave.RotatingFileManager.html#caproto.server.autosave.RotatingFileManager" title="caproto.server.autosave.RotatingFileManager"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RotatingFileManager</span></code></a>(filename, *[, ...])</p></td>
<td><p>Save to a primary filename, while rotating out old copies.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="status-statistics">
<h3>Status / Statistics<a class="headerlink" href="#status-statistics" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.stats.StatusHelper.html#caproto.server.stats.StatusHelper" title="caproto.server.stats.StatusHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">StatusHelper</span></code></a>(prefix, *[, macros, parent, name])</p></td>
<td><p>An IocStats-like tool for caproto IOCs.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.server.stats.BasicStatusHelper.html#caproto.server.stats.BasicStatusHelper" title="caproto.server.stats.BasicStatusHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BasicStatusHelper</span></code></a>(*args, **kwargs)</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="generated/caproto.server.stats.PeriodicStatusHelper.html#caproto.server.stats.PeriodicStatusHelper" title="caproto.server.stats.PeriodicStatusHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">PeriodicStatusHelper</span></code></a>(*args, **kwargs)</p></td>
<td><p>An IocStats-like tool for caproto IOCs.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="generated/caproto.server.stats.MemoryTracingHelper.html#caproto.server.stats.MemoryTracingHelper" title="caproto.server.stats.MemoryTracingHelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MemoryTracingHelper</span></code></a>(*args[, filters])</p></td>
<td><p>A helper which quickly allows for tracing memory usage and allocations on a caproto server instance.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="loggers.html" class="btn btn-neutral float-left" title="Logging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="generated/caproto.server.PVGroup.html" class="btn btn-neutral float-right" title="caproto.server.PVGroup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Daniel Allan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>